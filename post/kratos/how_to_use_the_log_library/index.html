<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>kratos æ—¥å¿—åº“çš„ä½¿ç”¨å§¿åŠ¿ - Daemon365</title><link rel=icon href=/imgs/favicon.ico><link rel=manifest href=/manifest.json><meta name=theme-color content="#007aff"><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="default"><meta name=apple-mobile-web-app-title content="Daemon365"><meta name=description content="ä»€ä¹ˆæ˜¯æ—¥å¿—

æ‰€è°“æ—¥å¿—ï¼ˆLogï¼‰æ˜¯æŒ‡ç³»ç»Ÿæ‰€æŒ‡å®šå¯¹è±¡çš„æŸäº›æ“ä½œå’Œå…¶æ“ä½œç»“æœæŒ‰æ—¶é—´æœ‰åºçš„é›†åˆã€‚logæ–‡ä»¶å°±æ˜¯æ—¥å¿—æ–‡ä»¶ï¼Œlogæ–‡ä»¶è®°å½•äº†ç³»ç»Ÿå’Œç³»ç»Ÿçš„ç”¨æˆ·ä¹‹é—´äº¤äº’çš„ä¿¡æ¯ï¼Œæ˜¯è‡ªåŠ¨æ•è·äººä¸ç³»ç»Ÿç»ˆç«¯ä¹‹é—´äº¤äº’çš„ç±»å‹ã€å†…å®¹æˆ–æ—¶é—´çš„æ•°æ®æ”¶é›†æ–¹æ³•ã€‚

æ—¥å¿—æ˜¯ç”¨æ¥è®°å½•ï¼Œç”¨æˆ·æ“ä½œï¼Œç³»ç»ŸçŠ¶æ€ï¼Œé”™è¯¯ä¿¡æ¯ç­‰ç­‰å†…å®¹çš„æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„é‡è¦ â€¦"><meta name=keywords content="go,kratos"><meta name=author content="daemon365"><meta property="og:type" content="article"><meta property="og:url" content="https://daemon365.dev/post/kratos/how_to_use_the_log_library/"><meta property="og:title" content="kratos æ—¥å¿—åº“çš„ä½¿ç”¨å§¿åŠ¿ - Daemon365"><meta property="og:description" content="ä»€ä¹ˆæ˜¯æ—¥å¿—

æ‰€è°“æ—¥å¿—ï¼ˆLogï¼‰æ˜¯æŒ‡ç³»ç»Ÿæ‰€æŒ‡å®šå¯¹è±¡çš„æŸäº›æ“ä½œå’Œå…¶æ“ä½œç»“æœæŒ‰æ—¶é—´æœ‰åºçš„é›†åˆã€‚logæ–‡ä»¶å°±æ˜¯æ—¥å¿—æ–‡ä»¶ï¼Œlogæ–‡ä»¶è®°å½•äº†ç³»ç»Ÿå’Œç³»ç»Ÿçš„ç”¨æˆ·ä¹‹é—´äº¤äº’çš„ä¿¡æ¯ï¼Œæ˜¯è‡ªåŠ¨æ•è·äººä¸ç³»ç»Ÿç»ˆç«¯ä¹‹é—´äº¤äº’çš„ç±»å‹ã€å†…å®¹æˆ–æ—¶é—´çš„æ•°æ®æ”¶é›†æ–¹æ³•ã€‚

æ—¥å¿—æ˜¯ç”¨æ¥è®°å½•ï¼Œç”¨æˆ·æ“ä½œï¼Œç³»ç»ŸçŠ¶æ€ï¼Œé”™è¯¯ä¿¡æ¯ç­‰ç­‰å†…å®¹çš„æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„é‡è¦ â€¦"><meta property="og:image" content="https://daemon365.dev/imgs/avatar.svg"><meta property="og:locale" content="en"><meta property="og:site_name" content="Daemon365"><meta property="article:published_time" content="2021-08-19T18:11:50+08:00"><meta property="article:modified_time" content="2021-08-19T18:11:50+08:00"><meta property="article:author" content="daemon365"><meta property="article:section" content="kratos"><meta property="article:tag" content="go"><meta property="article:tag" content="kratos"><meta name=twitter:card content="summary_large_image"><meta name=twitter:url content="https://daemon365.dev/post/kratos/how_to_use_the_log_library/"><meta name=twitter:title content="kratos æ—¥å¿—åº“çš„ä½¿ç”¨å§¿åŠ¿ - Daemon365"><meta name=twitter:description content="ä»€ä¹ˆæ˜¯æ—¥å¿—

æ‰€è°“æ—¥å¿—ï¼ˆLogï¼‰æ˜¯æŒ‡ç³»ç»Ÿæ‰€æŒ‡å®šå¯¹è±¡çš„æŸäº›æ“ä½œå’Œå…¶æ“ä½œç»“æœæŒ‰æ—¶é—´æœ‰åºçš„é›†åˆã€‚logæ–‡ä»¶å°±æ˜¯æ—¥å¿—æ–‡ä»¶ï¼Œlogæ–‡ä»¶è®°å½•äº†ç³»ç»Ÿå’Œç³»ç»Ÿçš„ç”¨æˆ·ä¹‹é—´äº¤äº’çš„ä¿¡æ¯ï¼Œæ˜¯è‡ªåŠ¨æ•è·äººä¸ç³»ç»Ÿç»ˆç«¯ä¹‹é—´äº¤äº’çš„ç±»å‹ã€å†…å®¹æˆ–æ—¶é—´çš„æ•°æ®æ”¶é›†æ–¹æ³•ã€‚

æ—¥å¿—æ˜¯ç”¨æ¥è®°å½•ï¼Œç”¨æˆ·æ“ä½œï¼Œç³»ç»ŸçŠ¶æ€ï¼Œé”™è¯¯ä¿¡æ¯ç­‰ç­‰å†…å®¹çš„æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„é‡è¦ â€¦"><meta name=twitter:image content="https://daemon365.dev/imgs/avatar.svg"><link rel=canonical href=https://daemon365.dev/post/kratos/how_to_use_the_log_library/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"kratos æ—¥å¿—åº“çš„ä½¿ç”¨å§¿åŠ¿","description":"\u003ch2 id=\u0022ä»€ä¹ˆæ˜¯æ—¥å¿—\u0022\u003eä»€ä¹ˆæ˜¯æ—¥å¿—\u003c\/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ‰€è°“æ—¥å¿—ï¼ˆLogï¼‰æ˜¯æŒ‡ç³»ç»Ÿæ‰€æŒ‡å®šå¯¹è±¡çš„æŸäº›æ“ä½œå’Œå…¶æ“ä½œç»“æœæŒ‰æ—¶é—´æœ‰åºçš„é›†åˆã€‚logæ–‡ä»¶å°±æ˜¯æ—¥å¿—æ–‡ä»¶ï¼Œlogæ–‡ä»¶è®°å½•äº†ç³»ç»Ÿå’Œç³»ç»Ÿçš„ç”¨æˆ·ä¹‹é—´äº¤äº’çš„ä¿¡æ¯ï¼Œæ˜¯è‡ªåŠ¨æ•è·äººä¸ç³»ç»Ÿç»ˆç«¯ä¹‹é—´äº¤äº’çš„ç±»å‹ã€å†…å®¹æˆ–æ—¶é—´çš„æ•°æ®æ”¶é›†æ–¹æ³•ã€‚\u003c\/p\u003e\n\u003c\/blockquote\u003e\n\u003cp\u003eæ—¥å¿—æ˜¯ç”¨æ¥è®°å½•ï¼Œç”¨æˆ·æ“ä½œï¼Œç³»ç»ŸçŠ¶æ€ï¼Œé”™è¯¯ä¿¡æ¯ç­‰ç­‰å†…å®¹çš„æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„é‡è¦ â€¦\u003c\/p\u003e","datePublished":"2021-08-19T18:11:50\u002b08:00","dateModified":"2021-08-19T18:11:50\u002b08:00","author":{"@type":"Person","name":"daemon365"},"publisher":{"@type":"Organization","name":"Daemon365","logo":{"@type":"ImageObject","url":"https:\/\/daemon365.dev\/imgs\/favicon.ico"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/daemon365.dev\/post\/kratos\/how_to_use_the_log_library\/"},"inLanguage":"en"}</script><meta name=robots content="index, follow"><meta name=googlebot content="index, follow"><link rel=stylesheet href=/css/components/variables.css><link rel=stylesheet href=/css/components/base.css><link rel=stylesheet href=/css/components/layout.css><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/css/components/search.css><link rel=stylesheet href=/css/components/toc.css><link rel=stylesheet href=/css/components/image-preview.css><link rel=stylesheet href=/css/components/reading-progress.css><style>:root{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,sans-serif}</style></head><body><div class=reading-progress-bar></div><header class=site-header><div class=container><div class=header-content><div class=site-branding><a href=/ class=site-logo><span class=site-title>Daemon365</span></a></div><nav class=site-nav><ul class=nav-menu><li><a href=/><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
Home</a></li><li><a href=/about><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
About</a></li><li><a href=/archives><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
Archives</a></li><li><a href=/categories><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
Categories</a></li><li><a href=/tags><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
Tags</a></li><li><button class=search-trigger aria-label=Search>
<svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
Search</button></li></ul></nav></div></div></header><main class=main-content><div class=post-container><div class=container><article class=post-content><header class=post-header><h1 class=post-title>kratos æ—¥å¿—åº“çš„ä½¿ç”¨å§¿åŠ¿</h1><div class=post-meta><time datetime=2021-08-19><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2021-08-19
</time><a href=/categories/kratos class=category-link><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
kratos
</a><span class=reading-time><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
6 min read
</span><span class=word-count><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
1079 words</span></div><div class=post-tags><a href=/tags/go class=tag><svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
go
</a><a href=/tags/kratos class=tag><svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
kratos</a></div></header><div class=post-body><h2 id=ä»€ä¹ˆæ˜¯æ—¥å¿—>ä»€ä¹ˆæ˜¯æ—¥å¿—</h2><blockquote><p>æ‰€è°“æ—¥å¿—ï¼ˆLogï¼‰æ˜¯æŒ‡ç³»ç»Ÿæ‰€æŒ‡å®šå¯¹è±¡çš„æŸäº›æ“ä½œå’Œå…¶æ“ä½œç»“æœæŒ‰æ—¶é—´æœ‰åºçš„é›†åˆã€‚logæ–‡ä»¶å°±æ˜¯æ—¥å¿—æ–‡ä»¶ï¼Œlogæ–‡ä»¶è®°å½•äº†ç³»ç»Ÿå’Œç³»ç»Ÿçš„ç”¨æˆ·ä¹‹é—´äº¤äº’çš„ä¿¡æ¯ï¼Œæ˜¯è‡ªåŠ¨æ•è·äººä¸ç³»ç»Ÿç»ˆç«¯ä¹‹é—´äº¤äº’çš„ç±»å‹ã€å†…å®¹æˆ–æ—¶é—´çš„æ•°æ®æ”¶é›†æ–¹æ³•ã€‚</p></blockquote><p>æ—¥å¿—æ˜¯ç”¨æ¥è®°å½•ï¼Œç”¨æˆ·æ“ä½œï¼Œç³»ç»ŸçŠ¶æ€ï¼Œé”™è¯¯ä¿¡æ¯ç­‰ç­‰å†…å®¹çš„æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä¸€ä¸ªè‰¯å¥½çš„æ—¥å¿—è§„èŒƒï¼Œå¯¹äºç³»ç»Ÿè¿è¡ŒçŠ¶æ€çš„åˆ†æï¼Œä»¥åŠçº¿ä¸Šé—®é¢˜çš„è§£å†³å…·æœ‰é‡å¤§çš„æ„ä¹‰ã€‚</p><h3 id=æ—¥å¿—è§„èŒƒ>æ—¥å¿—è§„èŒƒ</h3><p>åœ¨å¼€å‘è½¯ä»¶æ‰“å°æ—¥å¿—æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸€äº›é—®é¢˜ï¼Œä¸¾ä¾‹å¯èƒ½ä¸å…¨ï¼Œå¯ä»¥è‡ªè¡Œç™¾åº¦ç›¸å…³æ–‡ç« æˆ–æŸ¥çœ‹æ–‡ç« åº•éƒ¨æ–‡çŒ®ï¼š</p><ul><li>é‡è¦åŠŸèƒ½æ—¥å¿—å°½å¯èƒ½çš„å®Œå–„ã€‚</li><li>ä¸è¦éšæ„æ‰“å°æ— ç”¨çš„æ—¥å¿—ï¼Œè¿‡å¤šæ— ç”¨çš„æ—¥å¿—ä¼šå¢åŠ åˆ†ææ—¥å¿—çš„éš¾åº¦ã€‚</li><li>æ—¥å¿—è¦åŒºåˆ†ç­‰çº§ å¦‚ debugï¼Œwarnï¼Œinfoï¼Œerror ç­‰ã€‚</li><li>æ•è·åˆ°æœªå¤„ç†é”™è¯¯æ—¶æœ€å¥½æ‰“å°é”™è¯¯å †æ ˆä¿¡æ¯</li></ul><h3 id=go-è¯­è¨€å¸¸ç”¨çš„æ—¥å¿—åº“>Go è¯­è¨€å¸¸ç”¨çš„æ—¥å¿—åº“</h3><p>Go è¯­è¨€æ ‡å‡†åº“ä¸­å°±ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ—¥å¿—åº“ <strong>log</strong>ï¼Œé™¤äº†è¿™ä¸ªä»¥å¤–è¿˜æœ‰å¾ˆå¤šæ—¥å¿—åº“ï¼Œå¦‚ <strong>logrus</strong>ï¼Œ<strong>glog</strong>ï¼Œ<strong>logx</strong>ï¼Œ<strong>Uber</strong> çš„ <strong>zap</strong> ç­‰ç­‰ï¼Œä¾‹å¦‚ <strong>zap</strong> å°±æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ï¼š</p><ul><li>é«˜æ€§èƒ½</li><li>é…ç½®é¡¹ä¸°å¯Œ</li><li>å¤šç§æ—¥å¿—çº§åˆ«</li><li>æ”¯æŒHook</li><li>ä¸°å¯Œçš„å·¥å…·åŒ…</li><li>æä¾›äº†sugar log</li><li>å¤šç§æ—¥å¿—æ‰“å°æ ¼å¼</li><li>&mldr;</li></ul><h5 id=ç®€å•ä½¿ç”¨>ç®€å•ä½¿ç”¨</h5><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>(</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;go.uber.org/zap&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>var</span> <span style=color:#75af00>logger</span> <span style=color:#f92672>*</span><span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>Logger</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>init</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>logger</span><span style=color:#111>,</span> <span style=color:#75af00>_</span> <span style=color:#111>=</span> <span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>NewProduction</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>logger</span><span style=color:#111>.</span><span style=color:#75af00>Error</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>		<span style=color:#d88200>&#34;My name is baobao&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>String</span><span style=color:#111>(</span><span style=color:#d88200>&#34;from&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;Hulun Buir&#34;</span><span style=color:#111>),</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>Error</span><span style=color:#111>(</span><span style=color:#75af00>errors</span><span style=color:#111>.</span><span style=color:#75af00>New</span><span style=color:#111>(</span><span style=color:#d88200>&#34;no good&#34;</span><span style=color:#111>)))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>logger</span><span style=color:#111>.</span><span style=color:#75af00>Info</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Worked in the Ministry of national development of China!&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>String</span><span style=color:#111>(</span><span style=color:#d88200>&#34;key&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;eatğŸš&#34;</span><span style=color:#111>),</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>String</span><span style=color:#111>(</span><span style=color:#d88200>&#34;key&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;sleepğŸ˜´&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>defer</span> <span style=color:#75af00>logger</span><span style=color:#111>.</span><span style=color:#75af00>Sync</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><h2 id=kratos-æ—¥å¿—åº“åŸç†è§£æ>Kratos æ—¥å¿—åº“åŸç†è§£æ</h2><blockquote><p>åœ¨ç§ä¸‹ä¸ <strong>Tonyè€å¸ˆ</strong> æ²Ÿé€šæ—¶å…³äºæ—¥å¿—åº“çš„å®ç°ç†å¿µæ—¶ï¼Œ<strong>Tonyè€å¸ˆ</strong> è¯´ï¼šç”±äºç›®å‰æ—¥å¿—åº“éå¸¸å¤šå¹¶ä¸”å¥½ç”¨ï¼Œåœ¨ <strong>Kratos</strong> çš„æ—¥å¿—ä¸­ï¼Œä¸»è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>ç»Ÿä¸€æ—¥å¿—æ¥å£è®¾è®¡</li><li>ç»„ç»‡ç»“æ„åŒ–æ—¥å¿—</li><li>å¹¶ä¸”éœ€è¦æœ‰å‹å¥½çš„æ—¥å¿—çº§åˆ«ä½¿ç”¨</li><li>æ”¯æŒå¤šè¾“å‡ºæºå¯¹æ¥éœ€æ±‚ï¼Œå¦‚log-agent æˆ–è€… 3rd æ—¥å¿—åº“</li></ol></blockquote><p><strong>kratos</strong> çš„æ—¥å¿—åº“ï¼Œä¸å¼ºåˆ¶å…·ä½“å®ç°æ–¹å¼ï¼Œåªæä¾›é€‚é…å™¨ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œå®ç°æ—¥å¿—åŠŸèƒ½ï¼Œåªéœ€è¦å®ç°<strong>kratos/log</strong> çš„ <strong>Logger interface</strong> å³å¯æ¥å…¥è‡ªå·±å–œæ¬¢çš„æ—¥å¿—ç³»ç»Ÿã€‚</p><p><strong>kratos</strong> çš„æ—¥å¿—åº“ï¼Œåœ¨è®¾è®¡é˜¶æ®µï¼Œå‚è€ƒäº†å¾ˆå¤šä¼˜ç§€çš„å¼€æºé¡¹ç›®å’Œå¤§å‚çš„æ—¥å¿—ç³»ç»Ÿå®ç°ï¼Œç»å†äº†å¤šæ¬¡æ”¹åŠ¨åæ‰å‘ˆç°ç»™å¤§å®¶ã€‚</p><h3 id=logåº“çš„ç»„æˆ>logåº“çš„ç»„æˆ</h3><p><strong>kratos</strong> çš„ <strong>log</strong> åº“ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ç»„æˆ</p><ul><li><strong>level.go</strong> å®šä¹‰æ—¥å¿—çº§åˆ«</li><li><strong>log.go</strong> æ—¥å¿—æ ¸å¿ƒ</li><li><strong>helper.go</strong> <strong>log</strong>çš„<strong>helper</strong></li><li><strong>value.go</strong> å®ç°åŠ¨æ€å€¼</li></ul><h3 id=æºç åˆ†æ>æºç åˆ†æ</h3><p><strong>kratos</strong> çš„ <strong>log</strong> åº“ä¸­, æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯ <strong>log.go</strong> ä»£ç éå¸¸ç®€æ´ï¼Œç¬¦åˆ <strong>kratos</strong> çš„è®¾è®¡ç†å¿µã€‚ <strong>log.go</strong> ä¸­å£°æ˜äº† <strong>Logger interface</strong>ï¼Œç”¨æˆ·åªéœ€è¦å®ç°æ¥å£ï¼Œå³å¯å¼•å…¥è‡ªå·±çš„æ—¥å¿—å®ç°ï¼Œä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p><h4 id=loggo><strong>log.go</strong></h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>log</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>(</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;log&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>var</span> <span style=color:#111>(</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// DefaultLogger is default logger.</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>DefaultLogger</span> <span style=color:#75af00>Logger</span> <span style=color:#111>=</span> <span style=color:#75af00>NewStdLogger</span><span style=color:#111>(</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Writer</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Logger æ¥å£, åé¢å®ç°è‡ªå®šä¹‰æ—¥å¿—åº“çš„æ—¶å€™ï¼Œå°±æ˜¯è¦å®ç°è¿™ä¸ªæ¥å£ã€‚</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Logger</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>level</span> <span style=color:#75af00>Level</span><span style=color:#111>,</span> <span style=color:#75af00>keyvals</span> <span style=color:#f92672>...</span><span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#00a8c8>error</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>logger</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>logs</span>      <span style=color:#111>[]</span><span style=color:#75af00>Logger</span> <span style=color:#75715e>// logger æ•°ç»„</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>prefix</span>    <span style=color:#111>[]</span><span style=color:#00a8c8>interface</span><span style=color:#111>{}</span> <span style=color:#75715e>// ä¸€äº›é»˜è®¤æ‰“å°çš„å€¼,ä¾‹å¦‚é€šè¿‡ With ç»‘å®šçš„ Valuer</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>hasValuer</span> <span style=color:#00a8c8>bool</span> <span style=color:#75715e>// æ˜¯å¦åŒ…å« Valuer </span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>ctx</span>       <span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Context</span> <span style=color:#75715e>// ä¸Šä¸‹æ–‡</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>logger</span><span style=color:#111>)</span> <span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>level</span> <span style=color:#75af00>Level</span><span style=color:#111>,</span> <span style=color:#75af00>keyvals</span> <span style=color:#f92672>...</span><span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#00a8c8>error</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>kvs</span> <span style=color:#f92672>:=</span> <span style=color:#111>make</span><span style=color:#111>([]</span><span style=color:#00a8c8>interface</span><span style=color:#111>{},</span> <span style=color:#ae81ff>0</span><span style=color:#111>,</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>prefix</span><span style=color:#111>)</span><span style=color:#f92672>+</span><span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>keyvals</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>kvs</span> <span style=color:#111>=</span> <span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#75af00>kvs</span><span style=color:#111>,</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>prefix</span><span style=color:#f92672>...</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// åˆ¤æ–­æ˜¯å¦å­˜åœ¨ valuer</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>hasValuer</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// ç»‘å®š valuer</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>bindValues</span><span style=color:#111>(</span><span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>ctx</span><span style=color:#111>,</span> <span style=color:#75af00>kvs</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>kvs</span> <span style=color:#111>=</span> <span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#75af00>kvs</span><span style=color:#111>,</span> <span style=color:#75af00>keyvals</span><span style=color:#f92672>...</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// éå† logsï¼Œè°ƒç”¨æ‰€æœ‰çš„ logger è¿›è¡Œæ—¥å¿—æ‰“å°ã€‚</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#75af00>_</span><span style=color:#111>,</span> <span style=color:#75af00>l</span> <span style=color:#f92672>:=</span> <span style=color:#00a8c8>range</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>logs</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>if</span> <span style=color:#75af00>err</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>level</span><span style=color:#111>,</span> <span style=color:#75af00>kvs</span><span style=color:#f92672>...</span><span style=color:#111>);</span> <span style=color:#75af00>err</span> <span style=color:#f92672>!=</span> <span style=color:#00a8c8>nil</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#00a8c8>return</span> <span style=color:#75af00>err</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>nil</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// With with logger fields.</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>With</span><span style=color:#111>(</span><span style=color:#75af00>l</span> <span style=color:#75af00>Logger</span><span style=color:#111>,</span> <span style=color:#75af00>kv</span> <span style=color:#f92672>...</span><span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#75af00>Logger</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// åˆ¤æ–­æ˜¯å¦èƒ½ æŠŠä¼ å…¥çš„ logger æ–­è¨€æˆ *logger</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#75af00>c</span><span style=color:#111>,</span> <span style=color:#75af00>ok</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>l</span><span style=color:#111>.(</span><span style=color:#f92672>*</span><span style=color:#75af00>logger</span><span style=color:#111>);</span> <span style=color:#75af00>ok</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// é¢„åˆ†é…å†…å­˜,makeäº†ä¸€ä¸ªç©ºé—´é•¿åº¦ä¸º c.prefix + keyvalsé•¿åº¦çš„ interfaceæ•°ç»„</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>kvs</span> <span style=color:#f92672>:=</span> <span style=color:#111>make</span><span style=color:#111>([]</span><span style=color:#00a8c8>interface</span><span style=color:#111>{},</span> <span style=color:#ae81ff>0</span><span style=color:#111>,</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>prefix</span><span style=color:#111>)</span><span style=color:#f92672>+</span><span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>kv</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// å¤„ç†æ‰“å°çš„å†…å®¹</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>kvs</span> <span style=color:#111>=</span> <span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#75af00>kvs</span><span style=color:#111>,</span> <span style=color:#75af00>kv</span><span style=color:#f92672>...</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>kvs</span> <span style=color:#111>=</span> <span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#75af00>kvs</span><span style=color:#111>,</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>prefix</span><span style=color:#f92672>...</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// containsValuer()ç”¨æ¥åˆ¤æ–­ kvs é‡Œé¢æ˜¯å¦å­˜åœ¨ valuer</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>logger</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>logs</span><span style=color:#111>:</span>      <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>logs</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>prefix</span><span style=color:#111>:</span>    <span style=color:#75af00>kvs</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>hasValuer</span><span style=color:#111>:</span> <span style=color:#75af00>containsValuer</span><span style=color:#111>(</span><span style=color:#75af00>kvs</span><span style=color:#111>),</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>ctx</span><span style=color:#111>:</span>       <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>ctx</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>logger</span><span style=color:#111>{</span><span style=color:#75af00>logs</span><span style=color:#111>:</span> <span style=color:#111>[]</span><span style=color:#75af00>Logger</span><span style=color:#111>{</span><span style=color:#75af00>l</span><span style=color:#111>},</span> <span style=color:#75af00>prefix</span><span style=color:#111>:</span> <span style=color:#75af00>kv</span><span style=color:#111>,</span> <span style=color:#75af00>hasValuer</span><span style=color:#111>:</span> <span style=color:#75af00>containsValuer</span><span style=color:#111>(</span><span style=color:#75af00>kv</span><span style=color:#111>)}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// WithContext ç»‘å®š ctx,æ³¨æ„ ctx å¿…é¡»éç©º</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>WithContext</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span> <span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Context</span><span style=color:#111>,</span> <span style=color:#75af00>l</span> <span style=color:#75af00>Logger</span><span style=color:#111>)</span> <span style=color:#75af00>Logger</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#75af00>c</span><span style=color:#111>,</span> <span style=color:#75af00>ok</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>l</span><span style=color:#111>.(</span><span style=color:#f92672>*</span><span style=color:#75af00>logger</span><span style=color:#111>);</span> <span style=color:#75af00>ok</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>logger</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>logs</span><span style=color:#111>:</span>      <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>logs</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>prefix</span><span style=color:#111>:</span>    <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>prefix</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>hasValuer</span><span style=color:#111>:</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>hasValuer</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>ctx</span><span style=color:#111>:</span>       <span style=color:#75af00>ctx</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>logger</span><span style=color:#111>{</span><span style=color:#75af00>logs</span><span style=color:#111>:</span> <span style=color:#111>[]</span><span style=color:#75af00>Logger</span><span style=color:#111>{</span><span style=color:#75af00>l</span><span style=color:#111>},</span> <span style=color:#75af00>ctx</span><span style=color:#111>:</span> <span style=color:#75af00>ctx</span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// MultiLogger åŒ…è£…å¤šä¸ªloggerï¼Œç®€å•è¯´å°±æ˜¯åŒæ—¶ä½¿ç”¨å¤šä¸ªloggeræ‰“å°</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>MultiLogger</span><span style=color:#111>(</span><span style=color:#75af00>logs</span> <span style=color:#f92672>...</span><span style=color:#75af00>Logger</span><span style=color:#111>)</span> <span style=color:#75af00>Logger</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>logger</span><span style=color:#111>{</span><span style=color:#75af00>logs</span><span style=color:#111>:</span> <span style=color:#75af00>logs</span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><h4 id=valuego>value.go</h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#75715e>// è¿”å› valuer å‡½æ•°.</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>Value</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span> <span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Context</span><span style=color:#111>,</span> <span style=color:#75af00>v</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{}</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#75af00>v</span><span style=color:#111>,</span> <span style=color:#75af00>ok</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>v</span><span style=color:#111>.(</span><span style=color:#75af00>Valuer</span><span style=color:#111>);</span> <span style=color:#75af00>ok</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#75af00>v</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>v</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...çœç•¥ä¸€äº›å†…ç½®çš„ valuer å®ç°</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ç»‘å®š valuer</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>bindValues</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span> <span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Context</span><span style=color:#111>,</span> <span style=color:#75af00>keyvals</span> <span style=color:#111>[]</span><span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#75af00>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span> <span style=color:#75af00>i</span> <span style=color:#111>&lt;</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>keyvals</span><span style=color:#111>);</span> <span style=color:#75af00>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>if</span> <span style=color:#75af00>v</span><span style=color:#111>,</span> <span style=color:#75af00>ok</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>keyvals</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>].(</span><span style=color:#75af00>Valuer</span><span style=color:#111>);</span> <span style=color:#75af00>ok</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>keyvals</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>]</span> <span style=color:#111>=</span> <span style=color:#75af00>v</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ˜¯å¦åŒ…å« valuer</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>containsValuer</span><span style=color:#111>(</span><span style=color:#75af00>keyvals</span> <span style=color:#111>[]</span><span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#00a8c8>bool</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#75af00>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span> <span style=color:#75af00>i</span> <span style=color:#111>&lt;</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>keyvals</span><span style=color:#111>);</span> <span style=color:#75af00>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>if</span> <span style=color:#75af00>_</span><span style=color:#111>,</span> <span style=color:#75af00>ok</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>keyvals</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>].(</span><span style=color:#75af00>Valuer</span><span style=color:#111>);</span> <span style=color:#75af00>ok</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>true</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>false</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><h4 id=helpergo>helper.go</h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>log</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>(</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Helper is a logger helper.</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Helper</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>logger</span> <span style=color:#75af00>Logger</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// åˆ›å»ºä¸€ä¸ª logger helper å®ä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>NewHelper</span><span style=color:#111>(</span><span style=color:#75af00>logger</span> <span style=color:#75af00>Logger</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>Helper</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>Helper</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>logger</span><span style=color:#111>:</span> <span style=color:#75af00>logger</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// é€šè¿‡ WithContext() è¿”å›åŒ…å« ctx çš„ä¸€ä¸ªæ—¥å¿—çš„å¸®åŠ©ç±»ï¼ŒåŒ…å«ä¸€äº›å®šä¹‰å¥½çš„æŒ‰çº§åˆ«æ‰“å°æ—¥å¿—çš„æ–¹æ³•</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>h</span> <span style=color:#f92672>*</span><span style=color:#75af00>Helper</span><span style=color:#111>)</span> <span style=color:#75af00>WithContext</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span> <span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Context</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>Helper</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>Helper</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>logger</span><span style=color:#111>:</span> <span style=color:#75af00>WithContext</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span><span style=color:#111>,</span> <span style=color:#75af00>h</span><span style=color:#111>.</span><span style=color:#75af00>logger</span><span style=color:#111>),</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>h</span> <span style=color:#f92672>*</span><span style=color:#75af00>Helper</span><span style=color:#111>)</span> <span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>level</span> <span style=color:#75af00>Level</span><span style=color:#111>,</span> <span style=color:#75af00>keyvals</span> <span style=color:#f92672>...</span><span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>h</span><span style=color:#111>.</span><span style=color:#75af00>logger</span><span style=color:#111>.</span><span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>level</span><span style=color:#111>,</span> <span style=color:#75af00>keyvals</span><span style=color:#f92672>...</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>h</span> <span style=color:#f92672>*</span><span style=color:#75af00>Helper</span><span style=color:#111>)</span> <span style=color:#75af00>Debug</span><span style=color:#111>(</span><span style=color:#75af00>a</span> <span style=color:#f92672>...</span><span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>h</span><span style=color:#111>.</span><span style=color:#75af00>logger</span><span style=color:#111>.</span><span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>LevelDebug</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;msg&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Sprint</span><span style=color:#111>(</span><span style=color:#75af00>a</span><span style=color:#f92672>...</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>h</span> <span style=color:#f92672>*</span><span style=color:#75af00>Helper</span><span style=color:#111>)</span> <span style=color:#75af00>Debugf</span><span style=color:#111>(</span><span style=color:#75af00>format</span> <span style=color:#00a8c8>string</span><span style=color:#111>,</span> <span style=color:#75af00>a</span> <span style=color:#f92672>...</span><span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>h</span><span style=color:#111>.</span><span style=color:#75af00>logger</span><span style=color:#111>.</span><span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>LevelDebug</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;msg&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Sprintf</span><span style=color:#111>(</span><span style=color:#75af00>format</span><span style=color:#111>,</span> <span style=color:#75af00>a</span><span style=color:#f92672>...</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...çœç•¥ä¸€äº›é‡å¤çš„æ–¹æ³•</span>
</span></span></code></pre></div><h4 id=é€šè¿‡å•å…ƒæµ‹è¯•äº†è§£è°ƒç”¨é€»è¾‘>é€šè¿‡å•å…ƒæµ‹è¯•äº†è§£è°ƒç”¨é€»è¾‘</h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>TestInfo</span><span style=color:#111>(</span><span style=color:#75af00>t</span> <span style=color:#f92672>*</span><span style=color:#75af00>testing</span><span style=color:#111>.</span><span style=color:#75af00>T</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>logger</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>DefaultLogger</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>logger</span> <span style=color:#111>=</span> <span style=color:#75af00>With</span><span style=color:#111>(</span><span style=color:#75af00>logger</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;ts&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>DefaultTimestamp</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;caller&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>DefaultCaller</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>logger</span><span style=color:#111>.</span><span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>LevelInfo</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;key1&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;value1&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><ol><li>å•æµ‹ä¸­é¦–å…ˆå£°æ˜äº†ä¸€ä¸ª <strong>logger</strong> ï¼Œç”¨çš„é»˜è®¤çš„ <strong>DefaultLogger</strong></li><li>è°ƒç”¨ <strong>log.go</strong> ä¸­çš„ <strong>With()</strong> å‡½æ•°ï¼Œ ä¼ å…¥äº† <strong>logger</strong> ,å’Œä¸¤ä¸ªåŠ¨æ€å€¼ï¼Œ <strong>DefaultTimestamp</strong> å’Œ <strong>DefaultCaller</strong>ã€‚</li><li>Withæ–¹æ³•è¢«è°ƒç”¨ï¼Œåˆ¤æ–­æ˜¯å¦èƒ½å°†å‚æ•° <strong>l</strong> ç±»å‹è½¬æ¢æˆ <strong>*logger</strong></li><li>å¦‚æœå¯ä»¥è½¬æ¢ï¼Œå°†ä¼ å…¥çš„KVï¼Œèµ‹å€¼ç»™ <strong>logger.prefix</strong> ä¸Šï¼Œç„¶åè°ƒç”¨ <strong>value.go</strong> ä¸­çš„ <strong>containsValuer()</strong> åˆ¤æ–­ä¼ å…¥çš„KVä¸­æ˜¯å¦å­˜åœ¨ Valuerç±»å‹çš„å€¼ï¼Œå°†ç»“æœèµ‹å€¼ç»™ <strong>context.hasValuer</strong>ï¼Œæœ€åè¿”å› <strong>Logger</strong> å¯¹è±¡</li><li>å¦åˆ™åˆ™ç›´æ¥è¿”å›ä¸€ä¸ª <strong>&amp;logger{logs: []Logger{l}, prefix: kv, hasValuer: containsValuer(kv)}</strong></li><li>ç„¶åæ‰“å°æ—¥å¿—æ—¶ï¼Œ<strong>logger struct</strong> çš„ <strong>Log</strong> æ–¹æ³•è¢«è°ƒç”¨</li><li><strong>Log()</strong> æ–¹æ³•é¦–å…ˆé¢„åˆ†é…äº† <strong>keyvals</strong> çš„ç©ºé—´ï¼Œç„¶ååˆ¤æ–­ <strong>hasValuer</strong>ï¼Œå¦‚æœä¸º <strong>true</strong>ï¼Œåˆ™è°ƒç”¨ <strong>valuer.go</strong> ä¸­çš„ <strong>bindValuer()</strong> å¹¶ä¼ å…¥äº† <strong>ctx</strong> ç„¶åè·å– <strong>valuer</strong> çš„å€¼<code>if v, ok := v.(Valuer); ok { return v() }</code></li></ol><p>8.æœ€åéå† <strong>logger.logs</strong> æ‰“å°æ—¥å¿—</p><h2 id=ä½¿ç”¨æ–¹æ³•>ä½¿ç”¨æ–¹æ³•</h2><h3 id=ä½¿ç”¨-logger-æ‰“å°æ—¥å¿—>ä½¿ç”¨ Logger æ‰“å°æ—¥å¿—</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75af00>logger</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>DefaultLogger</span>
</span></span><span style=display:flex><span><span style=color:#75af00>logger</span><span style=color:#111>.</span><span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>LevelInfo</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;key1&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;value1&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></div><h3 id=ä½¿ç”¨-helper-æ‰“å°æ—¥å¿—>ä½¿ç”¨ Helper æ‰“å°æ—¥å¿—</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75af00>log</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewHelper</span><span style=color:#111>(</span><span style=color:#75af00>DefaultLogger</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Debug</span><span style=color:#111>(</span><span style=color:#d88200>&#34;test debug&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Info</span><span style=color:#111>(</span><span style=color:#d88200>&#34;test info&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Warn</span><span style=color:#111>(</span><span style=color:#d88200>&#34;test warn&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Error</span><span style=color:#111>(</span><span style=color:#d88200>&#34;test error&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></div><h3 id=ä½¿ç”¨-valuer>ä½¿ç”¨ valuer</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75af00>logger</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>DefaultLogger</span>
</span></span><span style=display:flex><span><span style=color:#75af00>logger</span> <span style=color:#111>=</span> <span style=color:#75af00>With</span><span style=color:#111>(</span><span style=color:#75af00>logger</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;ts&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>DefaultTimestamp</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;caller&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>DefaultCaller</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>logger</span><span style=color:#111>.</span><span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>LevelInfo</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;msg&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;helloworld&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></div><h3 id=åŒæ—¶æ‰“å°å¤šä¸ª-logger>åŒæ—¶æ‰“å°å¤šä¸ª logger</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75af00>out</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewStdLogger</span><span style=color:#111>(</span><span style=color:#75af00>os</span><span style=color:#111>.</span><span style=color:#75af00>Stdout</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>err</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewStdLogger</span><span style=color:#111>(</span><span style=color:#75af00>os</span><span style=color:#111>.</span><span style=color:#75af00>Stderr</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>With</span><span style=color:#111>(</span><span style=color:#75af00>MultiLogger</span><span style=color:#111>(</span><span style=color:#75af00>out</span><span style=color:#111>,</span> <span style=color:#75af00>err</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>LevelInfo</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;msg&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;test&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></div><h3 id=ä½¿ç”¨-context>ä½¿ç”¨ context</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75af00>logger</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>With</span><span style=color:#111>(</span><span style=color:#75af00>NewStdLogger</span><span style=color:#111>(</span><span style=color:#75af00>os</span><span style=color:#111>.</span><span style=color:#75af00>Stdout</span><span style=color:#111>),</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;trace&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>Trace</span><span style=color:#111>(),</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>log</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewHelper</span><span style=color:#111>(</span><span style=color:#75af00>logger</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>WithValue</span><span style=color:#111>(</span><span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Background</span><span style=color:#111>(),</span> <span style=color:#d88200>&#34;trace_id&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;2233&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>WithContext</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span><span style=color:#111>).</span><span style=color:#75af00>Info</span><span style=color:#111>(</span><span style=color:#d88200>&#34;got trace!&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></div><h3 id=ä½¿ç”¨-filter-è¿‡æ»¤æ—¥å¿—>ä½¿ç”¨ filter è¿‡æ»¤æ—¥å¿—</h3><p>å¦‚æœéœ€è¦è¿‡æ»¤æ—¥å¿—ä¸­æŸäº›ä¸åº”è¯¥è¢«æ‰“å°æ˜æ–‡çš„å­—æ®µå¦‚ password ç­‰ï¼Œå¯ä»¥é€šè¿‡ log.NewFilter() æ¥å®ç°è¿‡æ»¤åŠŸèƒ½ã€‚</p><h4 id=é€šè¿‡-level-è¿‡æ»¤æ—¥å¿—>é€šè¿‡ level è¿‡æ»¤æ—¥å¿—</h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75af00>l</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewHelper</span><span style=color:#111>(</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewFilter</span><span style=color:#111>(</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>DefaultLogger</span><span style=color:#111>,</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>FilterLevel</span><span style=color:#111>(</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>LevelWarn</span><span style=color:#111>)))</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>LevelDebug</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;msg1&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;te1st debug&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Debug</span><span style=color:#111>(</span><span style=color:#d88200>&#34;test debug&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Debugf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;test %s&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;debug&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Debugw</span><span style=color:#111>(</span><span style=color:#d88200>&#34;log&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;test debug&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Warn</span><span style=color:#111>(</span><span style=color:#d88200>&#34;warn log&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></div><h4 id=é€šè¿‡-key-è¿‡æ»¤æ—¥å¿—>é€šè¿‡ key è¿‡æ»¤æ—¥å¿—</h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75af00>l</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewHelper</span><span style=color:#111>(</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewFilter</span><span style=color:#111>(</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>DefaultLogger</span><span style=color:#111>,</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>FilterKey</span><span style=color:#111>(</span><span style=color:#d88200>&#34;password&#34;</span><span style=color:#111>)))</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Debugw</span><span style=color:#111>(</span><span style=color:#d88200>&#34;password&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;123456&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></div><h5 id=é€šè¿‡-value-è¿‡æ»¤æ—¥å¿—>é€šè¿‡ value è¿‡æ»¤æ—¥å¿—</h5><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75af00>l</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewHelper</span><span style=color:#111>(</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewFilter</span><span style=color:#111>(</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>DefaultLogger</span><span style=color:#111>,</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>FilterValue</span><span style=color:#111>(</span><span style=color:#d88200>&#34;kratos&#34;</span><span style=color:#111>)))</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Debugw</span><span style=color:#111>(</span><span style=color:#d88200>&#34;name&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;kratos&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></div><h4 id=é€šè¿‡-hook-func-è¿‡æ»¤æ—¥å¿—>é€šè¿‡ hook func è¿‡æ»¤æ—¥å¿—</h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75af00>l</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewHelper</span><span style=color:#111>(</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewFilter</span><span style=color:#111>(</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>DefaultLogger</span><span style=color:#111>,</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>FilterFunc</span><span style=color:#111>(</span><span style=color:#75af00>testFilterFunc</span><span style=color:#111>)))</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Debug</span><span style=color:#111>(</span><span style=color:#d88200>&#34;debug level&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>Infow</span><span style=color:#111>(</span><span style=color:#d88200>&#34;password&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;123456&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>testFilterFunc</span><span style=color:#111>(</span><span style=color:#75af00>level</span> <span style=color:#75af00>Level</span><span style=color:#111>,</span> <span style=color:#75af00>keyvals</span> <span style=color:#f92672>...</span><span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#00a8c8>bool</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#75af00>level</span> <span style=color:#f92672>==</span> <span style=color:#75af00>LevelWarn</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>true</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#75af00>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span> <span style=color:#75af00>i</span> <span style=color:#111>&lt;</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>keyvals</span><span style=color:#111>);</span> <span style=color:#75af00>i</span><span style=color:#f92672>++</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>if</span> <span style=color:#75af00>keyvals</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>]</span> <span style=color:#f92672>==</span> <span style=color:#d88200>&#34;password&#34;</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>keyvals</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span> <span style=color:#111>=</span> <span style=color:#d88200>&#34;***&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>false</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><h2 id=ç”¨-zap-å®ç°-kratos-çš„æ—¥å¿—æ¥å£>ç”¨ Zap å®ç° kratos çš„æ—¥å¿—æ¥å£</h2><p>å®ç°çš„ä»£ç ååˆ†ç®€å•ï¼Œä»…æœ‰ä¸åˆ°100 è¡Œä»£ç ï¼Œä»…ä¾›å¤§å®¶å‚è€ƒã€‚</p><h3 id=å®ç°>å®ç°</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#75715e>// kratos/examples/log/zap.go</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>logger</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>(</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#34;os&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;github.com/go-kratos/kratos/v2/log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;go.uber.org/zap&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;go.uber.org/zap/zapcore&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;gopkg.in/natefinch/lumberjack.v2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>var</span> <span style=color:#75af00>_</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Logger</span> <span style=color:#111>=</span> <span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#75af00>ZapLogger</span><span style=color:#111>)(</span><span style=color:#00a8c8>nil</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Zap ç»“æ„ä½“</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>ZapLogger</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>log</span>  <span style=color:#f92672>*</span><span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>Logger</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Sync</span> <span style=color:#00a8c8>func</span><span style=color:#111>()</span> <span style=color:#00a8c8>error</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// åˆ›å»ºä¸€ä¸ª ZapLogger å®ä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>NewZapLogger</span><span style=color:#111>(</span><span style=color:#75af00>encoder</span> <span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>EncoderConfig</span><span style=color:#111>,</span> <span style=color:#75af00>level</span> <span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>AtomicLevel</span><span style=color:#111>,</span> <span style=color:#75af00>opts</span> <span style=color:#f92672>...</span><span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>Option</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>ZapLogger</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>writeSyncer</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>getLogWriter</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// è®¾ç½® zapcore</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>core</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>NewCore</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>NewConsoleEncoder</span><span style=color:#111>(</span><span style=color:#75af00>encoder</span><span style=color:#111>),</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>NewMultiWriteSyncer</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>AddSync</span><span style=color:#111>(</span><span style=color:#75af00>os</span><span style=color:#111>.</span><span style=color:#75af00>Stdout</span><span style=color:#111>),</span>
</span></span><span style=display:flex><span>		<span style=color:#111>),</span> <span style=color:#75af00>level</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//  new ä¸€ä¸ª *zap.Logger</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>zapLogger</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>New</span><span style=color:#111>(</span><span style=color:#75af00>core</span><span style=color:#111>,</span> <span style=color:#75af00>opts</span><span style=color:#f92672>...</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>ZapLogger</span><span style=color:#111>{</span><span style=color:#75af00>log</span><span style=color:#111>:</span> <span style=color:#75af00>zapLogger</span><span style=color:#111>,</span> <span style=color:#75af00>Sync</span><span style=color:#111>:</span> <span style=color:#75af00>zapLogger</span><span style=color:#111>.</span><span style=color:#75af00>Sync</span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Log æ–¹æ³•å®ç°äº† kratos/log/log.go ä¸­çš„ Logger interface</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>l</span> <span style=color:#f92672>*</span><span style=color:#75af00>ZapLogger</span><span style=color:#111>)</span> <span style=color:#75af00>Log</span><span style=color:#111>(</span><span style=color:#75af00>level</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Level</span><span style=color:#111>,</span> <span style=color:#75af00>keyvals</span> <span style=color:#f92672>...</span><span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#00a8c8>error</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>keyvals</span><span style=color:#111>)</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>keyvals</span><span style=color:#111>)</span><span style=color:#f92672>%</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>        	<span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Warn</span><span style=color:#111>(</span><span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Sprint</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Keyvalues must appear in pairs: &#34;</span><span style=color:#111>,</span> <span style=color:#75af00>keyvals</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>nil</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// æŒ‰ç…§ KV ä¼ å…¥çš„æ—¶å€™,ä½¿ç”¨çš„ zap.Field</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>var</span> <span style=color:#75af00>data</span> <span style=color:#111>[]</span><span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>Field</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#75af00>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span> <span style=color:#75af00>i</span> <span style=color:#111>&lt;</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>keyvals</span><span style=color:#111>);</span> <span style=color:#75af00>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>data</span> <span style=color:#111>=</span> <span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#75af00>data</span><span style=color:#111>,</span> <span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>Any</span><span style=color:#111>(</span><span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Sprint</span><span style=color:#111>(</span><span style=color:#75af00>keyvals</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>]),</span> <span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Sprint</span><span style=color:#111>(</span><span style=color:#75af00>keyvals</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>])))</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>switch</span> <span style=color:#75af00>level</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>case</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>LevelDebug</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Debug</span><span style=color:#111>(</span><span style=color:#d88200>&#34;&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>data</span><span style=color:#f92672>...</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>case</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>LevelInfo</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Info</span><span style=color:#111>(</span><span style=color:#d88200>&#34;&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>data</span><span style=color:#f92672>...</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>case</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>LevelWarn</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Warn</span><span style=color:#111>(</span><span style=color:#d88200>&#34;&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>data</span><span style=color:#f92672>...</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>case</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>LevelError</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>l</span><span style=color:#111>.</span><span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>Error</span><span style=color:#111>(</span><span style=color:#d88200>&#34;&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>data</span><span style=color:#f92672>...</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>nil</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ—¥å¿—è‡ªåŠ¨åˆ‡å‰²ï¼Œé‡‡ç”¨ lumberjack å®ç°çš„</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>getLogWriter</span><span style=color:#111>()</span> <span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>WriteSyncer</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>lumberJackLogger</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>lumberjack</span><span style=color:#111>.</span><span style=color:#75af00>Logger</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>Filename</span><span style=color:#111>:</span>   <span style=color:#d88200>&#34;./test.log&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>MaxSize</span><span style=color:#111>:</span>    <span style=color:#ae81ff>10</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>MaxBackups</span><span style=color:#111>:</span> <span style=color:#ae81ff>5</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>MaxAge</span><span style=color:#111>:</span>     <span style=color:#ae81ff>30</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>Compress</span><span style=color:#111>:</span>   <span style=color:#00a8c8>false</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>AddSync</span><span style=color:#111>(</span><span style=color:#75af00>lumberJackLogger</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><h3 id=ä½¿ç”¨æ–¹æ³•-1>ä½¿ç”¨æ–¹æ³•</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#75715e>// kratos/examples/log/zap_test.go</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>logger</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>(</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;github.com/go-kratos/kratos/v2/log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;go.uber.org/zap&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;go.uber.org/zap/zapcore&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>TestZapLogger</span><span style=color:#111>(</span><span style=color:#75af00>t</span> <span style=color:#f92672>*</span><span style=color:#75af00>testing</span><span style=color:#111>.</span><span style=color:#75af00>T</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>encoder</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>EncoderConfig</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>TimeKey</span><span style=color:#111>:</span>        <span style=color:#d88200>&#34;t&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>LevelKey</span><span style=color:#111>:</span>       <span style=color:#d88200>&#34;level&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>NameKey</span><span style=color:#111>:</span>        <span style=color:#d88200>&#34;logger&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>CallerKey</span><span style=color:#111>:</span>      <span style=color:#d88200>&#34;caller&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>MessageKey</span><span style=color:#111>:</span>     <span style=color:#d88200>&#34;msg&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>StacktraceKey</span><span style=color:#111>:</span>  <span style=color:#d88200>&#34;stack&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>EncodeTime</span><span style=color:#111>:</span>     <span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>ISO8601TimeEncoder</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>LineEnding</span><span style=color:#111>:</span>     <span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>DefaultLineEnding</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>EncodeLevel</span><span style=color:#111>:</span>    <span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>LowercaseLevelEncoder</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>EncodeDuration</span><span style=color:#111>:</span> <span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>SecondsDurationEncoder</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>EncodeCaller</span><span style=color:#111>:</span>   <span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>FullCallerEncoder</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>logger</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>NewZapLogger</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>encoder</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>NewAtomicLevelAt</span><span style=color:#111>(</span><span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>DebugLevel</span><span style=color:#111>),</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>AddStacktrace</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>NewAtomicLevelAt</span><span style=color:#111>(</span><span style=color:#75af00>zapcore</span><span style=color:#111>.</span><span style=color:#75af00>ErrorLevel</span><span style=color:#111>)),</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>AddCallerSkip</span><span style=color:#111>(</span><span style=color:#ae81ff>2</span><span style=color:#111>),</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>zap</span><span style=color:#111>.</span><span style=color:#75af00>Development</span><span style=color:#111>(),</span>
</span></span><span style=display:flex><span>	<span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>zlog</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>log</span><span style=color:#111>.</span><span style=color:#75af00>NewHelper</span><span style=color:#111>(</span><span style=color:#75af00>logger</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>zlog</span><span style=color:#111>.</span><span style=color:#75af00>Infow</span><span style=color:#111>(</span><span style=color:#d88200>&#34;name&#34;</span><span style=color:#111>,</span><span style=color:#d88200>&#34;go è¯­è¨€è¿›é˜¶&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>defer</span> <span style=color:#75af00>logger</span><span style=color:#111>.</span><span style=color:#75af00>Sync</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><h2 id=å‚è€ƒæ–‡çŒ®>å‚è€ƒæ–‡çŒ®</h2><ul><li>å…³äº log åº“çš„è®¨è®º <a href=https://github.com/go-kratos/kratos/issues/882>issue</a></li><li>Uber çš„æ—¥å¿—åº“ Zap <a href=https://github.com/uber-go/zap>uber/zap</a></li><li>æ—¥å¿—å‰²æ¥åº“ <a href=https://github.com/natefinch/lumberjack>lumberjack</a></li><li>åŸºäº zap çš„æ—¥å¿—demo <a href=https://github.com/go-kratos/kratos/tree/main/examples/log>log example</a></li></ul><p><img src=/images/df29de7c-11e2-4f40-94b1-699617bbc438.png alt></p></div><footer class=post-footer><div class=post-license><p><strong>Article Title:</strong> kratos æ—¥å¿—åº“çš„ä½¿ç”¨å§¿åŠ¿</p><p><strong>Author:</strong> daemon365</p><p><strong>Permalink:</strong> <a href=https://daemon365.dev/post/kratos/how_to_use_the_log_library/>https://daemon365.dev/post/kratos/how_to_use_the_log_library/</a></p><p><strong>License:</strong> This article is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>BY-NC-SA</a>. Please cite the source when reposting.</p></div><nav class=post-navigation><a href=/post/cloud/linux_basic_system_optimization/ class=nav-prev><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg><div><span class=nav-label>Previous</span>
<span class=nav-title>LinuxåŸºç¡€ç³»ç»Ÿä¼˜åŒ–</span></div></a><a href=/post/cloud/prometheus/ class=nav-next><div><span class=nav-label>Next</span>
<span class=nav-title>Prometheus</span></div><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></a></nav><div class=post-comments><script src=https://utteranc.es/client.js repo=daemon365/blog issue-term=pathname label=comments theme=preferred-color-scheme crossorigin=anonymous async></script></div></footer></article></div></div><div class=toc-float-button id=tocButton><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5.0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5.0 014 19.5v-15A2.5 2.5.0 016.5 2z"/></svg></div><div class=toc-panel id=tocPanel><div class=toc-panel-header><h3 class=toc-panel-title>Table of Contents</h3><button class=toc-panel-close id=tocClose>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div><nav class=toc-panel-nav id=TableOfContents><nav id=TableOfContents><ul><li><a href=#ä»€ä¹ˆæ˜¯æ—¥å¿—>ä»€ä¹ˆæ˜¯æ—¥å¿—</a><ul><li><a href=#æ—¥å¿—è§„èŒƒ>æ—¥å¿—è§„èŒƒ</a></li><li><a href=#go-è¯­è¨€å¸¸ç”¨çš„æ—¥å¿—åº“>Go è¯­è¨€å¸¸ç”¨çš„æ—¥å¿—åº“</a><ul><li></li></ul></li></ul></li><li><a href=#kratos-æ—¥å¿—åº“åŸç†è§£æ>Kratos æ—¥å¿—åº“åŸç†è§£æ</a><ul><li><a href=#logåº“çš„ç»„æˆ>logåº“çš„ç»„æˆ</a></li><li><a href=#æºç åˆ†æ>æºç åˆ†æ</a><ul><li><a href=#loggo><strong>log.go</strong></a></li><li><a href=#valuego>value.go</a></li><li><a href=#helpergo>helper.go</a></li><li><a href=#é€šè¿‡å•å…ƒæµ‹è¯•äº†è§£è°ƒç”¨é€»è¾‘>é€šè¿‡å•å…ƒæµ‹è¯•äº†è§£è°ƒç”¨é€»è¾‘</a></li></ul></li></ul></li><li><a href=#ä½¿ç”¨æ–¹æ³•>ä½¿ç”¨æ–¹æ³•</a><ul><li><a href=#ä½¿ç”¨-logger-æ‰“å°æ—¥å¿—>ä½¿ç”¨ Logger æ‰“å°æ—¥å¿—</a></li><li><a href=#ä½¿ç”¨-helper-æ‰“å°æ—¥å¿—>ä½¿ç”¨ Helper æ‰“å°æ—¥å¿—</a></li><li><a href=#ä½¿ç”¨-valuer>ä½¿ç”¨ valuer</a></li><li><a href=#åŒæ—¶æ‰“å°å¤šä¸ª-logger>åŒæ—¶æ‰“å°å¤šä¸ª logger</a></li><li><a href=#ä½¿ç”¨-context>ä½¿ç”¨ context</a></li><li><a href=#ä½¿ç”¨-filter-è¿‡æ»¤æ—¥å¿—>ä½¿ç”¨ filter è¿‡æ»¤æ—¥å¿—</a><ul><li><a href=#é€šè¿‡-level-è¿‡æ»¤æ—¥å¿—>é€šè¿‡ level è¿‡æ»¤æ—¥å¿—</a></li><li><a href=#é€šè¿‡-key-è¿‡æ»¤æ—¥å¿—>é€šè¿‡ key è¿‡æ»¤æ—¥å¿—</a></li><li><a href=#é€šè¿‡-hook-func-è¿‡æ»¤æ—¥å¿—>é€šè¿‡ hook func è¿‡æ»¤æ—¥å¿—</a></li></ul></li></ul></li><li><a href=#ç”¨-zap-å®ç°-kratos-çš„æ—¥å¿—æ¥å£>ç”¨ Zap å®ç° kratos çš„æ—¥å¿—æ¥å£</a><ul><li><a href=#å®ç°>å®ç°</a></li><li><a href=#ä½¿ç”¨æ–¹æ³•-1>ä½¿ç”¨æ–¹æ³•</a></li></ul></li><li><a href=#å‚è€ƒæ–‡çŒ®>å‚è€ƒæ–‡çŒ®</a></li></ul></nav></nav></div></main><footer class=site-footer><div class=container><div class=footer-content><div class=footer-info><p class=copyright>Â© 2025 daemon365</p><p class=powered-by>Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/daemon365/hugo-theme-daemon target=_blank rel=noopener>Daemon</a></p></div><div class=social-links><a href=https://github.com/daemon365 target=_blank rel=noopener aria-label=GitHub><svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a href=mailto:daemon365@foxmail.com aria-label=Email><svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></div></div></div></footer><div class=search-modal id=searchModal><div class=search-modal-backdrop></div><div class=search-modal-content><div class=search-modal-header><input type=text class=search-input id=searchInput placeholder="Search articles..." autofocus>
<button class=search-close aria-label="Close search">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div><div class=search-results id=searchResults><p class=search-hint>Enter 2 or more characters to start searching</p></div></div></div><script src=/js/components/search.js></script><script src=/js/components/toc.js></script><script src=/js/components/scroll-effects.js></script><script src=/js/components/code-copy.js></script><script src=/js/components/lazy-loading.js></script><script src=/js/components/image-preview.js></script><script src=/js/components/back-to-top.js></script><script src=/js/main-new.js></script><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker registered:",e.scope)}).catch(e=>{console.log("Service Worker registration failed:",e)})})</script></body></html>