<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Kratos漫游指南 1 - 概览 - Daemon365</title><link rel=icon href=/imgs/favicon.ico><link rel=manifest href=/manifest.json><meta name=theme-color content="#007aff"><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="default"><meta name=apple-mobile-web-app-title content="Daemon365"><meta name=description content="您好，地球人，欢迎来到Kratos漫游指南。
对于刚开始研究Kratos框架的开发者来说，目前的文档有些零散，这与我们的模块化设计有一些关系，不过Don&rsquo;t panic，从这篇文章开始，我将试图打破这一现状，漫游指南系列将循序渐进地介绍Kratos框架，理顺框架的使用思路，使您更快上手 …"><meta name=keywords content="go,kratos"><meta name=author content="daemon365"><meta property="og:type" content="article"><meta property="og:url" content="https://daemon365.dev/post/kratos/the_hitchhikers_guide_to_kratos_1___overview/"><meta property="og:title" content="Kratos漫游指南 1 - 概览 - Daemon365"><meta property="og:description" content="您好，地球人，欢迎来到Kratos漫游指南。
对于刚开始研究Kratos框架的开发者来说，目前的文档有些零散，这与我们的模块化设计有一些关系，不过Don&rsquo;t panic，从这篇文章开始，我将试图打破这一现状，漫游指南系列将循序渐进地介绍Kratos框架，理顺框架的使用思路，使您更快上手 …"><meta property="og:image" content="https://daemon365.dev/imgs/avatar.svg"><meta property="og:locale" content="en"><meta property="og:site_name" content="Daemon365"><meta property="article:published_time" content="2021-09-02T00:00:00+08:00"><meta property="article:modified_time" content="2021-09-02T00:00:00+08:00"><meta property="article:author" content="daemon365"><meta property="article:section" content="kratos"><meta property="article:tag" content="go"><meta property="article:tag" content="kratos"><meta name=twitter:card content="summary_large_image"><meta name=twitter:url content="https://daemon365.dev/post/kratos/the_hitchhikers_guide_to_kratos_1___overview/"><meta name=twitter:title content="Kratos漫游指南 1 - 概览 - Daemon365"><meta name=twitter:description content="您好，地球人，欢迎来到Kratos漫游指南。
对于刚开始研究Kratos框架的开发者来说，目前的文档有些零散，这与我们的模块化设计有一些关系，不过Don&rsquo;t panic，从这篇文章开始，我将试图打破这一现状，漫游指南系列将循序渐进地介绍Kratos框架，理顺框架的使用思路，使您更快上手 …"><meta name=twitter:image content="https://daemon365.dev/imgs/avatar.svg"><link rel=canonical href=https://daemon365.dev/post/kratos/the_hitchhikers_guide_to_kratos_1___overview/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kratos漫游指南 1 - 概览","description":"\u003cp\u003e您好，地球人，欢迎来到Kratos漫游指南。\u003c\/p\u003e\n\u003cp\u003e对于刚开始研究Kratos框架的开发者来说，目前的文档有些零散，这与我们的模块化设计有一些关系，不过Don\u0026rsquo;t panic，从这篇文章开始，我将试图打破这一现状，漫游指南系列将循序渐进地介绍Kratos框架，理顺框架的使用思路，使您更快上手 …\u003c\/p\u003e","datePublished":"2021-09-02T00:00:00\u002b08:00","dateModified":"2021-09-02T00:00:00\u002b08:00","author":{"@type":"Person","name":"daemon365"},"publisher":{"@type":"Organization","name":"Daemon365","logo":{"@type":"ImageObject","url":"https:\/\/daemon365.dev\/imgs\/favicon.ico"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/daemon365.dev\/post\/kratos\/the_hitchhikers_guide_to_kratos_1___overview\/"},"inLanguage":"en"}</script><meta name=robots content="index, follow"><meta name=googlebot content="index, follow"><link rel=stylesheet href=/css/components/variables.css><link rel=stylesheet href=/css/components/base.css><link rel=stylesheet href=/css/components/layout.css><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/css/components/search.css><link rel=stylesheet href=/css/components/toc.css><link rel=stylesheet href=/css/components/image-preview.css><link rel=stylesheet href=/css/components/reading-progress.css><style>:root{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,sans-serif}</style></head><body><div class=reading-progress-bar></div><header class=site-header><div class=container><div class=header-content><div class=site-branding><a href=/ class=site-logo><span class=site-title>Daemon365</span></a></div><nav class=site-nav><ul class=nav-menu><li><a href=/><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
Home</a></li><li><a href=/about><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
About</a></li><li><a href=/archives><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
Archives</a></li><li><a href=/categories><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
Categories</a></li><li><a href=/tags><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
Tags</a></li><li><button class=search-trigger aria-label=Search>
<svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
Search</button></li></ul></nav></div></div></header><main class=main-content><div class=post-container><div class=container><article class=post-content><header class=post-header><h1 class=post-title>Kratos漫游指南 1 - 概览</h1><div class=post-meta><time datetime=2021-09-02><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2021-09-02
</time><a href=/categories/kratos class=category-link><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
kratos
</a><span class=reading-time><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
2 min read
</span><span class=word-count><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
351 words</span></div><div class=post-tags><a href=/tags/go class=tag><svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
go
</a><a href=/tags/kratos class=tag><svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
kratos</a></div></header><div class=post-body><p>您好，地球人，欢迎来到Kratos漫游指南。</p><p>对于刚开始研究Kratos框架的开发者来说，目前的文档有些零散，这与我们的模块化设计有一些关系，不过Don&rsquo;t panic，从这篇文章开始，我将试图打破这一现状，漫游指南系列将循序渐进地介绍Kratos框架，理顺框架的使用思路，使您更快上手Kratos。</p><p>同时，这个系列也会逐步整合进官方文档中，同时重新组织整个文档的结构和内容，敬请期待。</p><p>本篇是该系列的第一篇，主要介绍Kratos的整体概况。</p><h2 id=设计哲学>设计哲学</h2><p>Kratos是一个Go语言实现的微服务框架，说得更准确一点，它更类似于一个使用Go构建微服务的工具箱，开发者可以按照自己的习惯选用或定制其中的的组件，来打造自己的微服务。也正是由于这样的原因，Kratos并不绑定于特定的基础设施，不限定于某种注册中心，或数据库ORM等，所以您可以十分轻松地将任意库集成进项目里，与Kratos共同运作。</p><p>围绕这样的核心设计理念，我们设计了如下的项目生态：</p><ul><li><a href=https://github.com/go-kratos/kratos>kratos</a> Kratos框架核心，主要包含了基础的CLI工具，内置的HTTP/gRPC接口生成和服务生命周期管理，提供链路追踪、配置文件、日志、服务发现、监控等组件能力和相关接口定义。</li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib>contrib</a> 基于上述核心定义的基础接口，对配置文件、日志、服务发现、监控等服务进行具体实现所形成的一系列插件，可以直接使用它们，也可以参考它们的代码，做您需要的服务的适配，从而集成进kratos项目中来。</li><li><a href=https://github.com/go-kratos/aegis>aegis</a> 我们将服务可用性相关的算法：如限流、熔断等算法放在了这个独立的项目里，几乎没有外部依赖，它更不依赖Kratos，您可以在直接在任意项目中使用。您也可以轻松将它集成到Kratos中使用，提高服务的可用性。</li><li><a href=https://github.com/go-kratos/kratos-layout>layout</a> 我们设计的一个默认的项目模板，它包含一个参考了DDD和简洁架构设计的项目结构、Makefile脚本和Dockerfile文件。但这个项目模板不是必需的，您可以任意修改它，或使用自己设计的项目结构，Kratos依然可以正常工作。框架本身不对项目结构做任何假设和限制，您可以按照自己的想法来使用，具有很强的可定制性。</li><li><a href=https://github.com/go-kratos/gateway>gateway</a> 这个是我们刚刚起步，用Go开发的API Gateway，后续您可以使用它来作为您Kratos微服务的网关，用于微服务API的治理，项目正在施工中，欢迎关注。</li></ul><h2 id=仓库文档和社区>仓库、文档和社区</h2><p>GitHub仓库：<a href=https://github.com/go-kratos>https://github.com/go-kratos</a>
文档：<a href=https://go-kratos.dev/>https://go-kratos.dev/</a>
微信群：<a href=https://github.com/go-kratos/kratos/issues/682>go-kratos 官方微信群</a>
Discord：<a href=https://discord.com/invite/BWzJsUJ>go-kratos</a></p><h2 id=为什么v2完全重新设计>为什么v2完全重新设计</h2><p>以前关注过kratos项目的可能知道，Kratos的<a href=https://github.com/go-kratos/kratos/tree/v1.0.x>v1</a>版本已经开源了很久，也是个较为完善的框架。那么为什么不直接基于v1继续迭代，而是要推倒重来，推出完全重新设计的v2呢？</p><p>经验源自踩坑。</p><p>在业务不断迭代、项目不断膨胀的情况下，我们发现，过去的框架和项目结构设计，导致代码变更成本逐渐升高，而没有进行合理的抽象，导致更难进行模块的测试，也更难对第三方基础库进行适配和迁移，这在一定程度上拉低了生产力。</p><p>因此，我们参考了大量的DDD和Clean Architecture等业界先进设计理念，重新设计了微服务的项目结构，并且这个结构随着我们的后续研究，会进一步进行迭代，让它成为微服务项目结构的最佳实践。</p><p>没错，新版本的是从kratos-layout开始的。也许刚接触这个项目结构时会觉得不适应，但随着项目迭代，代码复杂度的提高，这个定义良好的结构，将使项目保持优秀的代码可读性、可测试性，以及令人满意的开发效率和可维护性。</p><p>更重要的一点是，这一次我们想面向社区来设计和开发这个框架。让更多的开发者能够使用我们的框架来提高生产力，同时参与到我们的项目中来。</p><p>所以我们把整个框架设计成为一个插座，我们希望整个框架轻量，插件化，可定制。对于几乎每一个微服务相关的功能模块，我们都设计了标准化接口，对于第三方库设计为插件，这样就能迅速把任意基础设施集成到使用Kratos的项目里，因此，无论您的公司使用何种基础设施，有何种规范，您都可以轻松将Kratos定制成与您的开发、生产环境相匹配的样子。</p><p>不破不立，v2是一次从内到外的彻底革新，我们无法在旧版本上修修补补，而是选择重新设计和开发新版本。而目前v2版本也已经在很多生产环境使用，我们也将持续迭代和完善这个框架，同时也更欢迎各位开发者参与进来，一起让它变得更好。</p><h2 id=数据库缓存消息队列>数据库/缓存/消息队列/&mldr;</h2><p>正如前文提到的，Kratos框架不限制您使用任何第三方库来进行项目开发，因此您可以根据喜好来选择库进行集成。我们也会逐步针对更多被广泛使用的第三方库开发插件。</p><p>这里给出一些被广泛使用的库供参考：</p><p>数据库：</p><ul><li><a href=https://pkg.go.dev/database/sql>database/sql</a> 官方库</li><li><a href=https://github.com/go-gorm/gorm>gorm</a></li><li><a href=https://github.com/ent/ent>ent</a></li></ul><p>缓存：</p><ul><li><a href=https://github.com/go-redis/redis>go-redis</a></li><li><a href=https://github.com/gomodule/redigo>redigo</a></li><li><a href=https://github.com/bradfitz/gomemcache>gomemcache</a></li></ul><p>消息队列：</p><ul><li><a href=https://github.com/Shopify/sarama>sarama</a> kafka客户端</li><li><a href=https://github.com/segmentio/kafka-go>kafka-go</a></li></ul><p>其它更多的优秀go库，可以在<a href=https://github.com/avelino/awesome-go>awesome-go</a>这个仓库中找找。</p><h2 id=cli工具>CLI工具</h2><p>kratos命令目前主要用于从模板创建项目，维护依赖包版本等。具体请参考<a href=https://go-kratos.dev/docs/getting-started/usage>文档</a></p><h2 id=protobuf定义api>Protobuf定义API</h2><p>Kratos使用Protobuf进行API定义。Protobuf是由Google开发的一种语言中立的数据序列化协议。它有结构定义清晰、可扩展性好、体积小、性能优秀等特点，在众多公司和项目被广泛使用。</p><p>在使用Kratos的项目中，您将使用如下的IDL进行您的接口定义，并且通过<code>protoc</code>工具生成相应的<code>.pb.go</code>文件，其中包含根据定义生成的的服务端和客户端代码。随后您就可以在自己的项目内部注册服务端代码使用，或引用客户端代码进行远程调用。</p><p>Kratos默认仅生成gRPC接口的代码，如果需要生成HTTP代码，请在proto文件中使用<code>option (google.api.http)</code>来添加HTTP部分的定义后再进行生成。默认情况下，HTTP接口将使用JSON作为序列化格式，如果想使用其它序列化格式（form，XML等），请参考文档<a href=https://go-kratos.dev/docs/component/encoding>序列化</a>进行相应的配置即可。</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#111>syntax</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;proto3&#34;</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#f92672>package</span> <span style=color:#111>helloworld</span><span style=color:#f92672>.</span><span style=color:#111>v1</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#00a8c8>import</span> <span style=color:#d88200>&#34;google/api/annotations.proto&#34;</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#00a8c8>option</span> <span style=color:#111>go_package</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;github.com/go-kratos/kratos-layout/api/helloworld/v1;v1&#34;</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>// The greeting service definition.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>service</span> <span style=color:#111>Greeter</span> <span style=color:#111>{</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#75715e>// Sends a greeting
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#00a8c8>rpc</span> <span style=color:#111>SayHello</span> <span style=color:#111>(</span><span style=color:#111>HelloRequest</span><span style=color:#111>)</span> <span style=color:#00a8c8>returns</span> <span style=color:#111>(</span><span style=color:#111>HelloReply</span><span style=color:#111>)</span>  <span style=color:#111>{</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        <span style=color:#00a8c8>option</span> <span style=color:#111>(</span><span style=color:#111>google.api.http</span><span style=color:#111>)</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>            <span style=color:#111>get</span><span style=color:#f92672>:</span> <span style=color:#d88200>&#34;/helloworld/{name}&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        <span style=color:#111>};</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#111>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#111>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>// The request message containing the user&#39;s name.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>message</span> <span style=color:#75af00>HelloRequest</span> <span style=color:#111>{</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#00a8c8>string</span> <span style=color:#111>name</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#111>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>// The response message containing the greetings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>message</span> <span style=color:#75af00>HelloReply</span> <span style=color:#111>{</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#00a8c8>string</span> <span style=color:#00a8c8>message</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#111>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>需要注意，虽然Protobuf定义的API的可靠性更强，但字段结构灵活性相对JSON要弱一些，因此如果您有诸如文件上传接口，或者某些无法对应到proto的JSON结构需要使用，我门还提供了“逃生门”，在我们的Protobuf体系之外定义这些接口，实现为普通的http.Handler并且挂载到路由上，或者用struct来定义您的字段。可以参考我们的<a href=https://github.com/go-kratos/kratos/blob/main/examples/http/upload/main.go>upload例子</a>进行实现。</p><h2 id=元信息传递>元信息传递</h2><p>服务之间的API调用，如果有某些元信息需要传递过去，而不是写在payload消息中，可以使用Metadata包进行字段设置和提取，具体细节参考<a href=https://go-kratos.dev/docs/component/metadata>元信息传递文档</a></p><h2 id=错误处理>错误处理</h2><p>Kratos的<a href=https://github.com/go-kratos/kratos/tree/main/errors>errors</a>模块提供了error的封装。框架也预定义了一系列<a href=https://github.com/go-kratos/kratos/blob/main/errors/types.go>标准错误</a>供使用。</p><p>错误处理这一块的设计也经过了很久的讨论才定下来，主要设计理念如下：</p><ol><li><code>code</code> 语义近似HTTP的Status Code（例如客户端传参数错误用400）同时也作为大类错误，在HTTP接口中的HTTP Code会使用它，好处是网关层可以根据这个code触发相应策略（重试、限流、熔断等）。</li><li><code>reason</code> 业务的具体错误码，为可读的字符串，能够表明，在同一个服务中应该唯一。</li><li><code>message</code> 用户可读的信息，可以在客户端（App、浏览器等）进行相应的展示给用户看。</li><li><code>metadata</code> 为一些附加信息，可以作为补充信息使用。</li></ol><p>在API返回的错误信息中，以HTTP接口为例，消息结构大概是长这个样子的：</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 错误码，跟 http-status 一致，并且在 grpc 中可以转换成 grpc-status
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>&#34;code&#34;</span><span style=color:#111>:</span> <span style=color:#ae81ff>500</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 错误原因，定义为业务判定错误码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>&#34;reason&#34;</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;USER_NOT_FOUND&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 错误信息，为用户可读的信息，可作为用户提示内容
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>&#34;message&#34;</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;invalid argument error&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 错误元信息，为错误添加附加可扩展信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>&#34;metadata&#34;</span><span style=color:#111>:</span> <span style=color:#111>{</span><span style=color:#f92672>&#34;some-key&#34;</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;some-value&#34;</span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><p>在Kratos中您可以使用proto文件定义您的业务错误，并通过工具生成对应的处理逻辑和方法。（如使用layout中提供的<code>make errors</code>指令。）</p><p>错误定义：</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#111>syntax</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;proto3&#34;</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#f92672>package</span> <span style=color:#111>api</span><span style=color:#f92672>.</span><span style=color:#111>blog.v1</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#00a8c8>import</span> <span style=color:#d88200>&#34;errors/errors.proto&#34;</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#00a8c8>option</span> <span style=color:#111>go_package</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;github.com/go-kratos/kratos/examples/blog/api/v1;v1&#34;</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#00a8c8>enum</span> <span style=color:#111>ErrorReason</span> <span style=color:#111>{</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#75715e>// 设置缺省错误码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#00a8c8>option</span> <span style=color:#111>(</span><span style=color:#111>errors.default_code</span><span style=color:#111>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>500</span><span style=color:#111>;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#75715e>// 为某个枚举单独设置错误码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#111>USER_NOT_FOUND</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#111>[(</span><span style=color:#111>errors.code</span><span style=color:#111>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>404</span><span style=color:#111>];</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#111>CONTENT_MISSING</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#111>[(</span><span style=color:#111>errors.code</span><span style=color:#111>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>400</span><span style=color:#111>];;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#111>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>错误创建：</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 通过 errors.New() 响应错误</span>
</span></span><span style=display:flex><span><span style=color:#75af00>errors</span><span style=color:#111>.</span><span style=color:#75af00>New</span><span style=color:#111>(</span><span style=color:#ae81ff>500</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;USER_NAME_EMPTY&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;user name is empty&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 通过 proto 生成的代码响应错误，并且包名应替换为自己生成代码后的 package name</span>
</span></span><span style=display:flex><span><span style=color:#75af00>api</span><span style=color:#111>.</span><span style=color:#75af00>ErrorUserNotFound</span><span style=color:#111>(</span><span style=color:#d88200>&#34;user %s not found&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;kratos&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 传递metadata</span>
</span></span><span style=display:flex><span><span style=color:#75af00>err</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>errors</span><span style=color:#111>.</span><span style=color:#75af00>New</span><span style=color:#111>(</span><span style=color:#ae81ff>500</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;USER_NAME_EMPTY&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;user name is empty&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>err</span> <span style=color:#111>=</span> <span style=color:#75af00>err</span><span style=color:#111>.</span><span style=color:#75af00>WithMetadata</span><span style=color:#111>(</span><span style=color:#00a8c8>map</span><span style=color:#111>[</span><span style=color:#00a8c8>string</span><span style=color:#111>]</span><span style=color:#00a8c8>string</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#d88200>&#34;foo&#34;</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;bar&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span><span style=color:#111>})</span>
</span></span></code></pre></div><p>错误断言：</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75af00>err</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>wrong</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 通过 errors.Is() 断言</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>if</span> <span style=color:#75af00>errors</span><span style=color:#111>.</span><span style=color:#75af00>Is</span><span style=color:#111>(</span><span style=color:#75af00>err</span><span style=color:#111>,</span><span style=color:#75af00>errors</span><span style=color:#111>.</span><span style=color:#75af00>BadRequest</span><span style=color:#111>(</span><span style=color:#d88200>&#34;USER_NAME_EMPTY&#34;</span><span style=color:#111>,</span><span style=color:#d88200>&#34;&#34;</span><span style=color:#111>))</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// do something</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 通过判断 *Error.Reason 和 *Error.Code</span>
</span></span><span style=display:flex><span><span style=color:#75af00>e</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>errors</span><span style=color:#111>.</span><span style=color:#75af00>FromError</span><span style=color:#111>(</span><span style=color:#75af00>err</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>if</span>  <span style=color:#75af00>e</span><span style=color:#111>.</span><span style=color:#75af00>Reason</span> <span style=color:#f92672>==</span> <span style=color:#d88200>&#34;USER_NAME_EMPTY&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#75af00>e</span><span style=color:#111>.</span><span style=color:#75af00>Code</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>500</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// do something</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 通过 proto 生成的代码断言错误，并且包名应替换为自己生成代码后的 package name</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>if</span> <span style=color:#75af00>api</span><span style=color:#111>.</span><span style=color:#75af00>IsUserNotFound</span><span style=color:#111>(</span><span style=color:#75af00>err</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// do something</span>
</span></span><span style=display:flex><span><span style=color:#111>})</span>
</span></span></code></pre></div><h2 id=配置文件>配置文件</h2><p>Kratos提供了统一的接口，支持配置文件的加载和变更订阅。</p><p>通过实现<a href=https://github.com/go-kratos/kratos/blob/main/config/source.go>Source 和 Watcher</a>即可实现任意配置源（本地或远程）的配置文件加载和变更订阅。</p><p>已经实现了下列插件：</p><ul><li><a href=https://github.com/go-kratos/kratos/blob/main/config/file/file.go>file</a> 本地文件加载，Kratos内置</li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/config/apollo>apollo</a></li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/config/etcd>etcd</a></li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/config/kubernetes>kubernetes</a></li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/config/nacos>nacos</a></li></ul><h2 id=服务注册服务发现>服务注册&服务发现</h2><p>Kratos定义了统一的注册接口，通过实现<a href=https://github.com/go-kratos/kratos/blob/main/registry/registry.go>Registrar和Discovery</a>，您可以很轻松地将Kratos接入到您的注册中心中。</p><p>您也可以直接使用我们已经实现好的插件：</p><ul><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/registry/consul>consul</a></li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/registry/discovery>discovery</a></li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/registry/etcd>etcd</a></li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/registry/kubernetes>kubernetes</a></li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/registry/nacos>nacos</a></li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/registry/zookeeper>zookeeper</a></li></ul><h2 id=日志>日志</h2><p>Kratos的日志模块由两部分组成：</p><ol><li><a href=https://github.com/go-kratos/kratos/blob/main/log/log.go>Logger</a>：底层日志接口，用于快速适配各种日志库到框架中来，仅提供一个最简单的Log方法。</li><li><a href=https://github.com/go-kratos/kratos/blob/main/log/helper.go>Helper</a>：高级日志接口，提供了一系列带有日志等级和格式化方法的帮助函数，通常业务逻辑中建议使用这个，能够简化日志代码。</li></ol><p>我们已经实现好的插件用于适配目前一些日志库，您也可以参考它们的代码来实现自己需要的日志库的适配：</p><ul><li><a href=https://github.com/go-kratos/kratos/blob/main/log/std.go>std</a> 标准输出，Kratos内置</li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/log/fluent>fluent</a></li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/log/zap>zap</a></li></ul><h2 id=监控>监控</h2><p>监控告警方面，您可以通过实现<a href=https://github.com/go-kratos/kratos/blob/main/metrics/metrics.go>metrics相关接口</a>将服务的统计数据上报给监控平台。</p><p>也可以直接使用我们已经实现好的插件：</p><ul><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/metrics/datadog>datadog</a></li><li><a href=https://github.com/go-kratos/kratos/tree/main/contrib/metrics/prometheus>prometheus</a></li></ul><h2 id=链路追踪>链路追踪</h2><p>Kratos使用<a href=https://opentelemetry.io/>OpenTelemetry</a>作为分布式链路追踪所使用的标准，您可以通过对client和server<a href=https://go-kratos.dev/docs/component/middleware/tracing>配置tracing</a>来将服务接入到链路追踪平台（如<a href=https://www.jaegertracing.io/>jaeger</a>等），从而对服务的接口调用关系，耗时，错误等进行追踪。</p><h2 id=负载均衡>负载均衡</h2><p>Kratos内置了若干种<a href=https://github.com/go-kratos/kratos/tree/main/selector>负载均衡算法</a>，如Weighted round robin（默认）、P2C，Random等，您可以通过<a href=https://go-kratos.dev/docs/component/selector>在client初始化时配置</a>来使用他们。</p><h2 id=限流熔断>限流熔断</h2><p>Kratos提供了<a href=https://go-kratos.dev/docs/component/middleware/ratelimit>限流ratelimit</a>和<a href=https://go-kratos.dev/docs/component/middleware/circuitbreaker>熔断circuitbreaker</a>中间件，用于微服务出现异常故障时自动对流量进行限制，提升服务的健壮性，避免雪崩。这两个中间件使用的算法，也可以在我们的可用性算法仓库<a href=https://github.com/go-kratos/aegis>aegis</a>中找到，独立于Kratos直接使用。</p><h2 id=中间件>中间件</h2><p>您可以通过Kratos的middleware机制，统一微服务接口的某些共同逻辑。上面提到的功能插件，您可以通过实现<a href=https://github.com/go-kratos/kratos/blob/main/middleware/middleware.go>Middleware</a>编写Kratos能够使用的中间件。</p><p>同时在仓库的<a href=https://github.com/go-kratos/kratos/tree/main/middleware>middleware</a>目录下，我们也提供了一系列中间件供您使用。</p><h2 id=插件>插件</h2><p>除了上述提到的插件外，我们还提供了一些其它插件，完整的插件列表请参考文档<a href=https://go-kratos.dev/docs/getting-started/plugin>社区插件</a></p><h2 id=示例代码>示例代码</h2><p>如果您看过文档后，对某些功能的使用仍有疑惑，或者是希望寻找一些用Kratos写项目的灵感，在仓库的<a href=https://github.com/go-kratos/kratos/tree/main/examples>examples</a>目录下我们提供了很多代码供参考。</p><p>您也可以通过文档中的<a href=https://go-kratos.dev/docs/getting-started/examples>示例代码清单</a>页面来查阅有哪些示例。</p><h2 id=小结>小结</h2><p>使用Kratos在一般开发过程中用到大部分常用功能点，在本文已经做了简单介绍，相信您对本框架的情况已经有了大致的了解。限于篇幅原因，无法在一篇文章中涵盖到Kratos的全部细节，比如layout这个相对复杂的项目结构具体是怎么用的，我将在后续的文章中，继续对Kratos的框架设计思想和使用方法做更加详细的介绍，并且会结合具体的项目实例，介绍使用Kratos开发的完整流程。</p><h2 id=文章转自>文章转自</h2><ul><li><a href=https://farer.org/2021/10/20/the-hitchhikers-guide-to-kratos-1-overview/>https://farer.org/2021/10/20/the-hitchhikers-guide-to-kratos-1-overview/</a></li></ul><hr><p><img src=/images/9c138291-3015-4b02-a15c-1457371297ab.png alt></p><p><img src=/images/5e3a3a58-380d-4e6c-9e22-c0a0e245d98a.gif alt></p></div><footer class=post-footer><div class=post-license><p><strong>Article Title:</strong> Kratos漫游指南 1 - 概览</p><p><strong>Author:</strong> daemon365</p><p><strong>Permalink:</strong> <a href=https://daemon365.dev/post/kratos/the_hitchhikers_guide_to_kratos_1___overview/>https://daemon365.dev/post/kratos/the_hitchhikers_guide_to_kratos_1___overview/</a></p><p><strong>License:</strong> This article is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>BY-NC-SA</a>. Please cite the source when reposting.</p></div><nav class=post-navigation><a href=/post/kratos/link_tracing_based_on_opentelemetry/ class=nav-prev><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg><div><span class=nav-label>Previous</span>
<span class=nav-title>基于 OpenTelemetry 的链路追踪</span></div></a><a href=/post/kratos/analyzing_the_implementation_of_bbr_current_limiting_source_code_from_kratos/ class=nav-next><div><span class=nav-label>Next</span>
<span class=nav-title>从kratos分析BBR限流源码实现</span></div><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></a></nav><div class=post-comments><script src=https://utteranc.es/client.js repo=daemon365/blog issue-term=pathname label=comments theme=preferred-color-scheme crossorigin=anonymous async></script></div></footer></article></div></div><div class=toc-float-button id=tocButton><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5.0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5.0 014 19.5v-15A2.5 2.5.0 016.5 2z"/></svg></div><div class=toc-panel id=tocPanel><div class=toc-panel-header><h3 class=toc-panel-title>Table of Contents</h3><button class=toc-panel-close id=tocClose>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div><nav class=toc-panel-nav id=TableOfContents><nav id=TableOfContents><ul><li><a href=#设计哲学>设计哲学</a></li><li><a href=#仓库文档和社区>仓库、文档和社区</a></li><li><a href=#为什么v2完全重新设计>为什么v2完全重新设计</a></li><li><a href=#数据库缓存消息队列>数据库/缓存/消息队列/&mldr;</a></li><li><a href=#cli工具>CLI工具</a></li><li><a href=#protobuf定义api>Protobuf定义API</a></li><li><a href=#元信息传递>元信息传递</a></li><li><a href=#错误处理>错误处理</a></li><li><a href=#配置文件>配置文件</a></li><li><a href=#服务注册服务发现>服务注册&服务发现</a></li><li><a href=#日志>日志</a></li><li><a href=#监控>监控</a></li><li><a href=#链路追踪>链路追踪</a></li><li><a href=#负载均衡>负载均衡</a></li><li><a href=#限流熔断>限流熔断</a></li><li><a href=#中间件>中间件</a></li><li><a href=#插件>插件</a></li><li><a href=#示例代码>示例代码</a></li><li><a href=#小结>小结</a></li><li><a href=#文章转自>文章转自</a></li></ul></nav></nav></div></main><footer class=site-footer><div class=container><div class=footer-content><div class=footer-info><p class=copyright>© 2025 daemon365</p><p class=powered-by>Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/daemon365/hugo-theme-daemon target=_blank rel=noopener>Daemon</a></p></div><div class=social-links><a href=https://github.com/daemon365 target=_blank rel=noopener aria-label=GitHub><svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a href=mailto:daemon365@foxmail.com aria-label=Email><svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></div></div></div></footer><div class=search-modal id=searchModal><div class=search-modal-backdrop></div><div class=search-modal-content><div class=search-modal-header><input type=text class=search-input id=searchInput placeholder="Search articles..." autofocus>
<button class=search-close aria-label="Close search">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div><div class=search-results id=searchResults><p class=search-hint>Enter 2 or more characters to start searching</p></div></div></div><script src=/js/components/search.js></script><script src=/js/components/toc.js></script><script src=/js/components/scroll-effects.js></script><script src=/js/components/code-copy.js></script><script src=/js/components/lazy-loading.js></script><script src=/js/components/image-preview.js></script><script src=/js/components/back-to-top.js></script><script src=/js/main-new.js></script><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker registered:",e.scope)}).catch(e=>{console.log("Service Worker registration failed:",e)})})</script></body></html>