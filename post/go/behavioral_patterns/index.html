<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>行为模式 - Daemon365</title><link rel=icon href=/imgs/favicon.ico><link rel=manifest href=/manifest.json><meta name=theme-color content="#007aff"><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="default"><meta name=apple-mobile-web-app-title content="Daemon365"><meta name=description content='责任链模式
责任链模式是一种行为设计模式， 允许你将请求沿着处理者链进行发送。 收到请求后， 每个处理者均可对请求进行处理， 或将其传递给链上的下个处理者。比如 kratos,gin等开源库的中间件实现。
代码实现
package main

import (
	"context" …'><meta name=keywords content="go,设计模式"><meta name=author content="daemon365"><meta property="og:type" content="article"><meta property="og:url" content="https://daemon365.dev/post/go/behavioral_patterns/"><meta property="og:title" content="行为模式 - Daemon365"><meta property="og:description" content='责任链模式
责任链模式是一种行为设计模式， 允许你将请求沿着处理者链进行发送。 收到请求后， 每个处理者均可对请求进行处理， 或将其传递给链上的下个处理者。比如 kratos,gin等开源库的中间件实现。
代码实现
package main

import (
	"context" …'><meta property="og:image" content="https://daemon365.dev/imgs/avatar.svg"><meta property="og:locale" content="en"><meta property="og:site_name" content="Daemon365"><meta property="article:published_time" content="2023-09-25T00:00:00+08:00"><meta property="article:modified_time" content="2023-09-25T00:00:00+08:00"><meta property="article:author" content="daemon365"><meta property="article:section" content="go"><meta property="article:tag" content="go"><meta property="article:tag" content="设计模式"><meta name=twitter:card content="summary_large_image"><meta name=twitter:url content="https://daemon365.dev/post/go/behavioral_patterns/"><meta name=twitter:title content="行为模式 - Daemon365"><meta name=twitter:description content='责任链模式
责任链模式是一种行为设计模式， 允许你将请求沿着处理者链进行发送。 收到请求后， 每个处理者均可对请求进行处理， 或将其传递给链上的下个处理者。比如 kratos,gin等开源库的中间件实现。
代码实现
package main

import (
	"context" …'><meta name=twitter:image content="https://daemon365.dev/imgs/avatar.svg"><link rel=canonical href=https://daemon365.dev/post/go/behavioral_patterns/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"行为模式","description":"\u003ch2 id=\u0022责任链模式\u0022\u003e责任链模式\u003c\/h2\u003e\n\u003cp\u003e\u003cstrong\u003e责任链模式\u003c\/strong\u003e是一种行为设计模式， 允许你将请求沿着处理者链进行发送。 收到请求后， 每个处理者均可对请求进行处理， 或将其传递给链上的下个处理者。比如 \u003ccode\u003ekratos\u003c\/code\u003e,\u003ccode\u003egin\u003c\/code\u003e等开源库的中间件实现。\u003c\/p\u003e\n\u003ch3 id=\u0022代码实现\u0022\u003e代码实现\u003c\/h3\u003e\n\u003cdiv class=\u0022highlight\u0022\u003e\u003cpre tabindex=\u00220\u0022 style=\u0022color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\u0022\u003e\u003ccode class=\u0022language-go\u0022 data-lang=\u0022go\u0022\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003e\u003cspan style=\u0022color:#f92672\u0022\u003epackage\u003c\/span\u003e \u003cspan style=\u0022color:#75af00\u0022\u003emain\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003e\u003cspan style=\u0022color:#f92672\u0022\u003eimport\u003c\/span\u003e \u003cspan style=\u0022color:#111\u0022\u003e(\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003e\t\u003cspan style=\u0022color:#d88200\u0022\u003e\u0026#34;context\u0026#34; …\u003c\/span\u003e\u003c\/span\u003e\u003c\/span\u003e\u003c\/span\u003e\u003c\/span\u003e\u003c\/span\u003e\u003c\/span\u003e\u003c\/span\u003e\u003c\/span\u003e\u003c\/code\u003e\u003c\/pre\u003e\u003c\/div\u003e","datePublished":"2023-09-25T00:00:00\u002b08:00","dateModified":"2023-09-25T00:00:00\u002b08:00","author":{"@type":"Person","name":"daemon365"},"publisher":{"@type":"Organization","name":"Daemon365","logo":{"@type":"ImageObject","url":"https:\/\/daemon365.dev\/imgs\/favicon.ico"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/daemon365.dev\/post\/go\/behavioral_patterns\/"},"inLanguage":"en"}</script><meta name=robots content="index, follow"><meta name=googlebot content="index, follow"><link rel=stylesheet href=/css/components/variables.css><link rel=stylesheet href=/css/components/base.css><link rel=stylesheet href=/css/components/layout.css><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/css/components/search.css><link rel=stylesheet href=/css/components/toc.css><link rel=stylesheet href=/css/components/image-preview.css><link rel=stylesheet href=/css/components/reading-progress.css><style>:root{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,sans-serif}</style></head><body><div class=reading-progress-bar></div><header class=site-header><div class=container><div class=header-content><div class=site-branding><a href=/ class=site-logo><span class=site-title>Daemon365</span></a></div><nav class=site-nav><ul class=nav-menu><li><a href=/><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
Home</a></li><li><a href=/about><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
About</a></li><li><a href=/archives><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
Archives</a></li><li><a href=/categories><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
Categories</a></li><li><a href=/tags><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
Tags</a></li><li><button class=search-trigger aria-label=Search>
<svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
Search</button></li></ul></nav></div></div></header><main class=main-content><div class=post-container><div class=container><article class=post-content><header class=post-header><h1 class=post-title>行为模式</h1><div class=post-meta><time datetime=2023-09-25><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2023-09-25
</time><a href=/categories/go class=category-link><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
go
</a><span class=reading-time><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
10 min read
</span><span class=word-count><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
1939 words</span></div><div class=post-tags><a href=/tags/go class=tag><svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
go
</a><a href=/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F class=tag><svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
设计模式</a></div></header><div class=post-body><h2 id=责任链模式>责任链模式</h2><p><strong>责任链模式</strong>是一种行为设计模式， 允许你将请求沿着处理者链进行发送。 收到请求后， 每个处理者均可对请求进行处理， 或将其传递给链上的下个处理者。比如 <code>kratos</code>,<code>gin</code>等开源库的中间件实现。</p><h3 id=代码实现>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>(</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Handler</span> <span style=color:#00a8c8>func</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span> <span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Context</span><span style=color:#111>,</span> <span style=color:#75af00>req</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#111>(</span><span style=color:#75af00>resp</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{},</span> <span style=color:#75af00>err</span> <span style=color:#00a8c8>error</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Middleware</span> <span style=color:#00a8c8>func</span><span style=color:#111>(</span><span style=color:#75af00>next</span> <span style=color:#75af00>Handler</span><span style=color:#111>)</span> <span style=color:#75af00>Handler</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>Chain</span><span style=color:#111>(</span><span style=color:#75af00>middlewares</span> <span style=color:#f92672>...</span><span style=color:#75af00>Middleware</span><span style=color:#111>)</span> <span style=color:#75af00>Middleware</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>func</span><span style=color:#111>(</span><span style=color:#75af00>next</span> <span style=color:#75af00>Handler</span><span style=color:#111>)</span> <span style=color:#75af00>Handler</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>for</span> <span style=color:#75af00>i</span> <span style=color:#f92672>:=</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>middlewares</span><span style=color:#111>)</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span> <span style=color:#75af00>i</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span> <span style=color:#75af00>i</span><span style=color:#f92672>--</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>next</span> <span style=color:#111>=</span> <span style=color:#75af00>middlewares</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>](</span><span style=color:#75af00>next</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#75af00>next</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>Chain</span><span style=color:#111>(</span><span style=color:#00a8c8>func</span><span style=color:#111>(</span><span style=color:#75af00>next</span> <span style=color:#75af00>Handler</span><span style=color:#111>)</span> <span style=color:#75af00>Handler</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>func</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span> <span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Context</span><span style=color:#111>,</span> <span style=color:#75af00>req</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#111>(</span><span style=color:#75af00>resp</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{},</span> <span style=color:#75af00>err</span> <span style=color:#00a8c8>error</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;handler 1 before&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>resp</span><span style=color:#111>,</span> <span style=color:#75af00>err</span> <span style=color:#111>=</span> <span style=color:#75af00>next</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span><span style=color:#111>,</span> <span style=color:#75af00>req</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;handler 1 after&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>			<span style=color:#00a8c8>return</span> <span style=color:#75af00>resp</span><span style=color:#111>,</span> <span style=color:#75af00>err</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>},</span> <span style=color:#00a8c8>func</span><span style=color:#111>(</span><span style=color:#75af00>next</span> <span style=color:#75af00>Handler</span><span style=color:#111>)</span> <span style=color:#75af00>Handler</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>func</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span> <span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Context</span><span style=color:#111>,</span> <span style=color:#75af00>req</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#111>(</span><span style=color:#75af00>resp</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{},</span> <span style=color:#75af00>err</span> <span style=color:#00a8c8>error</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;handler 2 before&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>resp</span><span style=color:#111>,</span> <span style=color:#75af00>err</span> <span style=color:#111>=</span> <span style=color:#75af00>next</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span><span style=color:#111>,</span> <span style=color:#75af00>req</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;handler 2 after&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>			<span style=color:#00a8c8>return</span> <span style=color:#75af00>resp</span><span style=color:#111>,</span> <span style=color:#75af00>err</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>})</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>resp</span><span style=color:#111>,</span> <span style=color:#75af00>err</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>c</span><span style=color:#111>(</span><span style=color:#00a8c8>func</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span> <span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Context</span><span style=color:#111>,</span> <span style=color:#75af00>req</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#111>(</span><span style=color:#75af00>resp</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{},</span> <span style=color:#75af00>err</span> <span style=color:#00a8c8>error</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;handler req:&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>req</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#75af00>req</span><span style=color:#111>,</span> <span style=color:#00a8c8>nil</span>
</span></span><span style=display:flex><span>	<span style=color:#111>})(</span><span style=color:#75af00>context</span><span style=color:#111>.</span><span style=color:#75af00>Background</span><span style=color:#111>(),</span> <span style=color:#d88200>&#34;hello&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#75af00>resp</span><span style=color:#111>,</span> <span style=color:#75af00>err</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>handler 1 before
</span></span></span><span style=display:flex><span><span style=color:#75715e>handler 2 before
</span></span></span><span style=display:flex><span><span style=color:#75715e>handler req: hello
</span></span></span><span style=display:flex><span><span style=color:#75715e>handler 2 after
</span></span></span><span style=display:flex><span><span style=color:#75715e>handler 1 after
</span></span></span><span style=display:flex><span><span style=color:#75715e>hello &lt;nil&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div><h2 id=观察者模式>观察者模式</h2><p>观察者模式用于触发联动。一个对象的改变会触发其它观察者的相关动作，而此对象无需关心连动对象的具体实现。</p><h3 id=代码实现-1>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>subject</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>register</span><span style=color:#111>(</span><span style=color:#75af00>Observer</span> <span style=color:#75af00>observer</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>deregister</span><span style=color:#111>(</span><span style=color:#75af00>Observer</span> <span style=color:#75af00>observer</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>notifyAll</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>observer</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>update</span><span style=color:#111>(</span><span style=color:#00a8c8>string</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>getID</span><span style=color:#111>()</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>item</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>observerList</span> <span style=color:#111>[]</span><span style=color:#75af00>observer</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>name</span>         <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>inStock</span>      <span style=color:#00a8c8>bool</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>newItem</span><span style=color:#111>(</span><span style=color:#75af00>name</span> <span style=color:#00a8c8>string</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>item</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>item</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>name</span><span style=color:#111>:</span> <span style=color:#75af00>name</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>i</span> <span style=color:#f92672>*</span><span style=color:#75af00>item</span><span style=color:#111>)</span> <span style=color:#75af00>updateAvailability</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Item %s is now in stock\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>i</span><span style=color:#111>.</span><span style=color:#75af00>name</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>i</span><span style=color:#111>.</span><span style=color:#75af00>inStock</span> <span style=color:#111>=</span> <span style=color:#00a8c8>true</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>i</span><span style=color:#111>.</span><span style=color:#75af00>notifyAll</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>i</span> <span style=color:#f92672>*</span><span style=color:#75af00>item</span><span style=color:#111>)</span> <span style=color:#75af00>register</span><span style=color:#111>(</span><span style=color:#75af00>o</span> <span style=color:#75af00>observer</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>i</span><span style=color:#111>.</span><span style=color:#75af00>observerList</span> <span style=color:#111>=</span> <span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#75af00>i</span><span style=color:#111>.</span><span style=color:#75af00>observerList</span><span style=color:#111>,</span> <span style=color:#75af00>o</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>i</span> <span style=color:#f92672>*</span><span style=color:#75af00>item</span><span style=color:#111>)</span> <span style=color:#75af00>deregister</span><span style=color:#111>(</span><span style=color:#75af00>o</span> <span style=color:#75af00>observer</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>i</span><span style=color:#111>.</span><span style=color:#75af00>observerList</span> <span style=color:#111>=</span> <span style=color:#75af00>removeFromslice</span><span style=color:#111>(</span><span style=color:#75af00>i</span><span style=color:#111>.</span><span style=color:#75af00>observerList</span><span style=color:#111>,</span> <span style=color:#75af00>o</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>i</span> <span style=color:#f92672>*</span><span style=color:#75af00>item</span><span style=color:#111>)</span> <span style=color:#75af00>notifyAll</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#75af00>_</span><span style=color:#111>,</span> <span style=color:#75af00>observer</span> <span style=color:#f92672>:=</span> <span style=color:#00a8c8>range</span> <span style=color:#75af00>i</span><span style=color:#111>.</span><span style=color:#75af00>observerList</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>observer</span><span style=color:#111>.</span><span style=color:#75af00>update</span><span style=color:#111>(</span><span style=color:#75af00>i</span><span style=color:#111>.</span><span style=color:#75af00>name</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>removeFromslice</span><span style=color:#111>(</span><span style=color:#75af00>observerList</span> <span style=color:#111>[]</span><span style=color:#75af00>observer</span><span style=color:#111>,</span> <span style=color:#75af00>observerToRemove</span> <span style=color:#75af00>observer</span><span style=color:#111>)</span> <span style=color:#111>[]</span><span style=color:#75af00>observer</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>observerListLength</span> <span style=color:#f92672>:=</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>observerList</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#75af00>i</span><span style=color:#111>,</span> <span style=color:#75af00>observer</span> <span style=color:#f92672>:=</span> <span style=color:#00a8c8>range</span> <span style=color:#75af00>observerList</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>if</span> <span style=color:#75af00>observerToRemove</span><span style=color:#111>.</span><span style=color:#75af00>getID</span><span style=color:#111>()</span> <span style=color:#f92672>==</span> <span style=color:#75af00>observer</span><span style=color:#111>.</span><span style=color:#75af00>getID</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>observerList</span><span style=color:#111>[</span><span style=color:#75af00>observerListLength</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>],</span> <span style=color:#75af00>observerList</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>]</span> <span style=color:#111>=</span> <span style=color:#75af00>observerList</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>],</span> <span style=color:#75af00>observerList</span><span style=color:#111>[</span><span style=color:#75af00>observerListLength</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span>			<span style=color:#00a8c8>return</span> <span style=color:#75af00>observerList</span><span style=color:#111>[:</span><span style=color:#75af00>observerListLength</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>observerList</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>customer</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>id</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>customer</span><span style=color:#111>)</span> <span style=color:#75af00>update</span><span style=color:#111>(</span><span style=color:#75af00>itemName</span> <span style=color:#00a8c8>string</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Sending email to customer %s for item %s\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>id</span><span style=color:#111>,</span> <span style=color:#75af00>itemName</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>customer</span><span style=color:#111>)</span> <span style=color:#75af00>getID</span><span style=color:#111>()</span> <span style=color:#00a8c8>string</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>id</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>shirtItem</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>newItem</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Nike Shirt&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>observerFirst</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>customer</span><span style=color:#111>{</span><span style=color:#75af00>id</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;abc@gmail.com&#34;</span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>observerSecond</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>customer</span><span style=color:#111>{</span><span style=color:#75af00>id</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;xyz@gmail.com&#34;</span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>shirtItem</span><span style=color:#111>.</span><span style=color:#75af00>register</span><span style=color:#111>(</span><span style=color:#75af00>observerFirst</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>shirtItem</span><span style=color:#111>.</span><span style=color:#75af00>register</span><span style=color:#111>(</span><span style=color:#75af00>observerSecond</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>shirtItem</span><span style=color:#111>.</span><span style=color:#75af00>updateAvailability</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>Item Nike Shirt is now in stock
</span></span></span><span style=display:flex><span><span style=color:#75715e>Sending email to customer abc@gmail.com for item Nike Shirt
</span></span></span><span style=display:flex><span><span style=color:#75715e>Sending email to customer xyz@gmail.com for item Nike Shirt
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div><h2 id=模板方法模式>模板方法模式</h2><p>模版方法模式使用继承机制，把通用步骤和通用方法放到父类中，把具体实现延迟到子类中实现。使得实现符合开闭原则。</p><p>如实例代码中通用步骤在父类中实现（<code>准备</code>、<code>下载</code>、<code>保存</code>、<code>收尾</code>）下载和保存的具体实现留到子类中，并且提供 <code>保存</code>方法的默认实现。</p><p>因为Golang不提供继承机制，需要使用匿名组合模拟实现继承。</p><p>此处需要注意：因为父类需要调用子类方法，所以子类需要匿名组合父类的同时，父类需要持有子类的引用。</p><h3 id=代码实现-2>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Downloader</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Download</span><span style=color:#111>(</span><span style=color:#75af00>uri</span> <span style=color:#00a8c8>string</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>template</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>implement</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>uri</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>implement</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>download</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>save</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>newTemplate</span><span style=color:#111>(</span><span style=color:#75af00>impl</span> <span style=color:#75af00>implement</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>template</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>template</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>implement</span><span style=color:#111>:</span> <span style=color:#75af00>impl</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>t</span> <span style=color:#f92672>*</span><span style=color:#75af00>template</span><span style=color:#111>)</span> <span style=color:#75af00>Download</span><span style=color:#111>(</span><span style=color:#75af00>uri</span> <span style=color:#00a8c8>string</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>t</span><span style=color:#111>.</span><span style=color:#75af00>uri</span> <span style=color:#111>=</span> <span style=color:#75af00>uri</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Print</span><span style=color:#111>(</span><span style=color:#d88200>&#34;prepare downloading\n&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>t</span><span style=color:#111>.</span><span style=color:#75af00>implement</span><span style=color:#111>.</span><span style=color:#75af00>download</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>t</span><span style=color:#111>.</span><span style=color:#75af00>implement</span><span style=color:#111>.</span><span style=color:#75af00>save</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Print</span><span style=color:#111>(</span><span style=color:#d88200>&#34;finish downloading\n&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>t</span> <span style=color:#f92672>*</span><span style=color:#75af00>template</span><span style=color:#111>)</span> <span style=color:#75af00>save</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Print</span><span style=color:#111>(</span><span style=color:#d88200>&#34;default save\n&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>HTTPDownloader</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>*</span><span style=color:#75af00>template</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>NewHTTPDownloader</span><span style=color:#111>()</span> <span style=color:#75af00>Downloader</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>downloader</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>HTTPDownloader</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>template</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>newTemplate</span><span style=color:#111>(</span><span style=color:#75af00>downloader</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>downloader</span><span style=color:#111>.</span><span style=color:#75af00>template</span> <span style=color:#111>=</span> <span style=color:#75af00>template</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>downloader</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>d</span> <span style=color:#f92672>*</span><span style=color:#75af00>HTTPDownloader</span><span style=color:#111>)</span> <span style=color:#75af00>download</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;download %s via http\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>d</span><span style=color:#111>.</span><span style=color:#75af00>uri</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#75af00>HTTPDownloader</span><span style=color:#111>)</span> <span style=color:#75af00>save</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;http save\n&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>FTPDownloader</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>*</span><span style=color:#75af00>template</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>NewFTPDownloader</span><span style=color:#111>()</span> <span style=color:#75af00>Downloader</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>downloader</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>FTPDownloader</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>template</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>newTemplate</span><span style=color:#111>(</span><span style=color:#75af00>downloader</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>downloader</span><span style=color:#111>.</span><span style=color:#75af00>template</span> <span style=color:#111>=</span> <span style=color:#75af00>template</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>downloader</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>d</span> <span style=color:#f92672>*</span><span style=color:#75af00>FTPDownloader</span><span style=color:#111>)</span> <span style=color:#75af00>download</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;download %s via ftp\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>d</span><span style=color:#111>.</span><span style=color:#75af00>uri</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>downloader</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>NewHTTPDownloader</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>downloader</span><span style=color:#111>.</span><span style=color:#75af00>Download</span><span style=color:#111>(</span><span style=color:#d88200>&#34;http://example.com/abc.zip&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>downloader</span> <span style=color:#111>=</span> <span style=color:#75af00>NewFTPDownloader</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>downloader</span><span style=color:#111>.</span><span style=color:#75af00>Download</span><span style=color:#111>(</span><span style=color:#d88200>&#34;ftp://example.com/abc.zip&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>prepare downloading
</span></span></span><span style=display:flex><span><span style=color:#75715e>download http://example.com/abc.zip via http
</span></span></span><span style=display:flex><span><span style=color:#75715e>http save
</span></span></span><span style=display:flex><span><span style=color:#75715e>finish downloading
</span></span></span><span style=display:flex><span><span style=color:#75715e>prepare downloading
</span></span></span><span style=display:flex><span><span style=color:#75715e>download ftp://example.com/abc.zip via ftp
</span></span></span><span style=display:flex><span><span style=color:#75715e>default save
</span></span></span><span style=display:flex><span><span style=color:#75715e>finish downloading
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div><h2 id=命令模式>命令模式</h2><p><strong>命令模式</strong>是一种行为设计模式， 它可将请求转换为一个包含与请求相关的所有信息的独立对象。 该转换让你能根据不同的请求将方法参数化、 延迟请求执行或将其放入队列中， 且能实现可撤销操作。</p><p>命令模式本质是把某个对象的方法调用封装到对象中，方便传递、存储、调用。</p><p>示例中把主板单中的启动(start)方法和重启(reboot)方法封装为命令对象，再传递到主机(box)对象中。于两个按钮进行绑定：</p><ul><li>第一个机箱(box1)设置按钮1(button1) 为开机按钮2(button2)为重启。</li><li>第二个机箱(box1)设置按钮2(button2) 为开机按钮1(button1)为重启。</li></ul><p>从而得到配置灵活性。</p><p>除了配置灵活外，使用命令模式还可以用作：</p><ul><li>批处理</li><li>任务队列</li><li>undo, redo</li></ul><p>等把具体命令封装到对象中使用的场合</p><h3 id=代码实现-3>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>command</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Command</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Execute</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>StartCommand</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>mb</span> <span style=color:#f92672>*</span><span style=color:#75af00>MotherBoard</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>NewStartCommand</span><span style=color:#111>(</span><span style=color:#75af00>mb</span> <span style=color:#f92672>*</span><span style=color:#75af00>MotherBoard</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>StartCommand</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>StartCommand</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>mb</span><span style=color:#111>:</span> <span style=color:#75af00>mb</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>StartCommand</span><span style=color:#111>)</span> <span style=color:#75af00>Execute</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>mb</span><span style=color:#111>.</span><span style=color:#75af00>Start</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>RebootCommand</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>mb</span> <span style=color:#f92672>*</span><span style=color:#75af00>MotherBoard</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>NewRebootCommand</span><span style=color:#111>(</span><span style=color:#75af00>mb</span> <span style=color:#f92672>*</span><span style=color:#75af00>MotherBoard</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>RebootCommand</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>RebootCommand</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>mb</span><span style=color:#111>:</span> <span style=color:#75af00>mb</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>RebootCommand</span><span style=color:#111>)</span> <span style=color:#75af00>Execute</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>mb</span><span style=color:#111>.</span><span style=color:#75af00>Reboot</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>MotherBoard</span> <span style=color:#00a8c8>struct</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#75af00>MotherBoard</span><span style=color:#111>)</span> <span style=color:#75af00>Start</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Print</span><span style=color:#111>(</span><span style=color:#d88200>&#34;system starting\n&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#75af00>MotherBoard</span><span style=color:#111>)</span> <span style=color:#75af00>Reboot</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Print</span><span style=color:#111>(</span><span style=color:#d88200>&#34;system rebooting\n&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Box</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>button1</span> <span style=color:#75af00>Command</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>button2</span> <span style=color:#75af00>Command</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>NewBox</span><span style=color:#111>(</span><span style=color:#75af00>button1</span><span style=color:#111>,</span> <span style=color:#75af00>button2</span> <span style=color:#75af00>Command</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>Box</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>Box</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>button1</span><span style=color:#111>:</span> <span style=color:#75af00>button1</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>button2</span><span style=color:#111>:</span> <span style=color:#75af00>button2</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>b</span> <span style=color:#f92672>*</span><span style=color:#75af00>Box</span><span style=color:#111>)</span> <span style=color:#75af00>PressButton1</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>b</span><span style=color:#111>.</span><span style=color:#75af00>button1</span><span style=color:#111>.</span><span style=color:#75af00>Execute</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>b</span> <span style=color:#f92672>*</span><span style=color:#75af00>Box</span><span style=color:#111>)</span> <span style=color:#75af00>PressButton2</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>b</span><span style=color:#111>.</span><span style=color:#75af00>button2</span><span style=color:#111>.</span><span style=color:#75af00>Execute</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><h2 id=策略模式>策略模式</h2><p>它能让你定义一系列算法， 并将每种算法分别放入独立的类中， 以使算法的对象能够相互替换。</p><h3 id=代码实现-4>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Payment</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>context</span>  <span style=color:#f92672>*</span><span style=color:#75af00>PaymentContext</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>strategy</span> <span style=color:#75af00>PaymentStrategy</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>PaymentContext</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Name</span><span style=color:#111>,</span> <span style=color:#75af00>CardID</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Money</span>        <span style=color:#00a8c8>int</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>NewPayment</span><span style=color:#111>(</span><span style=color:#75af00>name</span><span style=color:#111>,</span> <span style=color:#75af00>cardid</span> <span style=color:#00a8c8>string</span><span style=color:#111>,</span> <span style=color:#75af00>money</span> <span style=color:#00a8c8>int</span><span style=color:#111>,</span> <span style=color:#75af00>strategy</span> <span style=color:#75af00>PaymentStrategy</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>Payment</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>Payment</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>context</span><span style=color:#111>:</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>PaymentContext</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>Name</span><span style=color:#111>:</span>   <span style=color:#75af00>name</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>CardID</span><span style=color:#111>:</span> <span style=color:#75af00>cardid</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>Money</span><span style=color:#111>:</span>  <span style=color:#75af00>money</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#111>},</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>strategy</span><span style=color:#111>:</span> <span style=color:#75af00>strategy</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>p</span> <span style=color:#f92672>*</span><span style=color:#75af00>Payment</span><span style=color:#111>)</span> <span style=color:#75af00>Pay</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>strategy</span><span style=color:#111>.</span><span style=color:#75af00>Pay</span><span style=color:#111>(</span><span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>context</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>PaymentStrategy</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Pay</span><span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#75af00>PaymentContext</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Cash</span> <span style=color:#00a8c8>struct</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#75af00>Cash</span><span style=color:#111>)</span> <span style=color:#75af00>Pay</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span> <span style=color:#f92672>*</span><span style=color:#75af00>PaymentContext</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Pay $%d to %s by cash\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>ctx</span><span style=color:#111>.</span><span style=color:#75af00>Money</span><span style=color:#111>,</span> <span style=color:#75af00>ctx</span><span style=color:#111>.</span><span style=color:#75af00>Name</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Bank</span> <span style=color:#00a8c8>struct</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#75af00>Bank</span><span style=color:#111>)</span> <span style=color:#75af00>Pay</span><span style=color:#111>(</span><span style=color:#75af00>ctx</span> <span style=color:#f92672>*</span><span style=color:#75af00>PaymentContext</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Pay $%d to %s by bank account %s\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>ctx</span><span style=color:#111>.</span><span style=color:#75af00>Money</span><span style=color:#111>,</span> <span style=color:#75af00>ctx</span><span style=color:#111>.</span><span style=color:#75af00>Name</span><span style=color:#111>,</span> <span style=color:#75af00>ctx</span><span style=color:#111>.</span><span style=color:#75af00>CardID</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>payment</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>NewPayment</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Ada&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;&#34;</span><span style=color:#111>,</span> <span style=color:#ae81ff>123</span><span style=color:#111>,</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>Cash</span><span style=color:#111>{})</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>payment</span><span style=color:#111>.</span><span style=color:#75af00>Pay</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>payment</span> <span style=color:#111>=</span> <span style=color:#75af00>NewPayment</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Bob&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;0002&#34;</span><span style=color:#111>,</span> <span style=color:#ae81ff>888</span><span style=color:#111>,</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>Bank</span><span style=color:#111>{})</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>payment</span><span style=color:#111>.</span><span style=color:#75af00>Pay</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>Pay $123 to Ada by cash
</span></span></span><span style=display:flex><span><span style=color:#75715e>Pay $888 to Bob by bank account 0002
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div><h2 id=状态模式>状态模式</h2><p>让你能在一个对象的内部状态变化时改变其行为， 使其看上去就像改变了自身所属的类一样。</p><h3 id=代码实现-5>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>(</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Machine 状态机</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Machine</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>state</span> <span style=color:#75af00>IState</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// SetState 更新状态</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Machine</span><span style=color:#111>)</span> <span style=color:#75af00>SetState</span><span style=color:#111>(</span><span style=color:#75af00>state</span> <span style=color:#75af00>IState</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>state</span> <span style=color:#111>=</span> <span style=color:#75af00>state</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// GetStateName 获取当前状态</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Machine</span><span style=color:#111>)</span> <span style=color:#75af00>GetStateName</span><span style=color:#111>()</span> <span style=color:#00a8c8>string</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>state</span><span style=color:#111>.</span><span style=color:#75af00>GetName</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Machine</span><span style=color:#111>)</span> <span style=color:#75af00>Approval</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>state</span><span style=color:#111>.</span><span style=color:#75af00>Approval</span><span style=color:#111>(</span><span style=color:#75af00>m</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Machine</span><span style=color:#111>)</span> <span style=color:#75af00>Reject</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>state</span><span style=color:#111>.</span><span style=color:#75af00>Reject</span><span style=color:#111>(</span><span style=color:#75af00>m</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// IState 状态</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>IState</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 审批通过</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Approval</span><span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Machine</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 驳回</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Reject</span><span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Machine</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 获取当前状态名称</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>GetName</span><span style=color:#111>()</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// leaderApproveState 直属领导审批</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>leaderApproveState</span> <span style=color:#00a8c8>struct</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Approval 获取状态名字</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>leaderApproveState</span><span style=color:#111>)</span> <span style=color:#75af00>Approval</span><span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Machine</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;leader 审批成功&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>SetState</span><span style=color:#111>(</span><span style=color:#75af00>GetFinanceApproveState</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// GetName 获取状态名字</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>leaderApproveState</span><span style=color:#111>)</span> <span style=color:#75af00>GetName</span><span style=color:#111>()</span> <span style=color:#00a8c8>string</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#d88200>&#34;LeaderApproveState&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Reject 获取状态名字</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>leaderApproveState</span><span style=color:#111>)</span> <span style=color:#75af00>Reject</span><span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Machine</span><span style=color:#111>)</span> <span style=color:#111>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>GetLeaderApproveState</span><span style=color:#111>()</span> <span style=color:#75af00>IState</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>leaderApproveState</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// financeApproveState 财务审批</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>financeApproveState</span> <span style=color:#00a8c8>struct</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Approval 审批通过</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>f</span> <span style=color:#75af00>financeApproveState</span><span style=color:#111>)</span> <span style=color:#75af00>Approval</span><span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Machine</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;财务审批成功&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;出发打款操作&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 拒绝</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>f</span> <span style=color:#75af00>financeApproveState</span><span style=color:#111>)</span> <span style=color:#75af00>Reject</span><span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Machine</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>SetState</span><span style=color:#111>(</span><span style=color:#75af00>GetLeaderApproveState</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// GetName 获取名字</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>f</span> <span style=color:#75af00>financeApproveState</span><span style=color:#111>)</span> <span style=color:#75af00>GetName</span><span style=color:#111>()</span> <span style=color:#00a8c8>string</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#d88200>&#34;FinanceApproveState&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// GetFinanceApproveState GetFinanceApproveState</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>GetFinanceApproveState</span><span style=color:#111>()</span> <span style=color:#75af00>IState</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>financeApproveState</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>m</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>Machine</span><span style=color:#111>{</span><span style=color:#75af00>state</span><span style=color:#111>:</span> <span style=color:#75af00>GetLeaderApproveState</span><span style=color:#111>()}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;LeaderApproveState&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>GetStateName</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>Approval</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;FinanceApproveState&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>GetStateName</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>Reject</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;LeaderApproveState&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>GetStateName</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>Approval</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#d88200>&#34;FinanceApproveState&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>GetStateName</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>Approval</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>LeaderApproveState LeaderApproveState
</span></span></span><span style=display:flex><span><span style=color:#75715e>leader 审批成功
</span></span></span><span style=display:flex><span><span style=color:#75715e>FinanceApproveState FinanceApproveState
</span></span></span><span style=display:flex><span><span style=color:#75715e>LeaderApproveState LeaderApproveState
</span></span></span><span style=display:flex><span><span style=color:#75715e>leader 审批成功
</span></span></span><span style=display:flex><span><span style=color:#75715e>FinanceApproveState FinanceApproveState
</span></span></span><span style=display:flex><span><span style=color:#75715e>财务审批成功
</span></span></span><span style=display:flex><span><span style=color:#75715e>出发打款操作
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div><h2 id=迭代器模式>迭代器模式</h2><p>让你能在不暴露集合底层表现形式 （列表、 栈和树等） 的情况下遍历集合中所有的元素。</p><h3 id=代码实现-6>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>collection</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>createIterator</span><span style=color:#111>()</span> <span style=color:#75af00>iterator</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>userCollection</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>users</span> <span style=color:#111>[]</span><span style=color:#f92672>*</span><span style=color:#75af00>user</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>u</span> <span style=color:#f92672>*</span><span style=color:#75af00>userCollection</span><span style=color:#111>)</span> <span style=color:#75af00>createIterator</span><span style=color:#111>()</span> <span style=color:#75af00>iterator</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>userIterator</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>users</span><span style=color:#111>:</span> <span style=color:#75af00>u</span><span style=color:#111>.</span><span style=color:#75af00>users</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>iterator</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>hasNext</span><span style=color:#111>()</span> <span style=color:#00a8c8>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>getNext</span><span style=color:#111>()</span> <span style=color:#f92672>*</span><span style=color:#75af00>user</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>userIterator</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>index</span> <span style=color:#00a8c8>int</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>users</span> <span style=color:#111>[]</span><span style=color:#f92672>*</span><span style=color:#75af00>user</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>u</span> <span style=color:#f92672>*</span><span style=color:#75af00>userIterator</span><span style=color:#111>)</span> <span style=color:#75af00>hasNext</span><span style=color:#111>()</span> <span style=color:#00a8c8>bool</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#75af00>u</span><span style=color:#111>.</span><span style=color:#75af00>index</span> <span style=color:#111>&lt;</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>u</span><span style=color:#111>.</span><span style=color:#75af00>users</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>true</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>u</span> <span style=color:#f92672>*</span><span style=color:#75af00>userIterator</span><span style=color:#111>)</span> <span style=color:#75af00>getNext</span><span style=color:#111>()</span> <span style=color:#f92672>*</span><span style=color:#75af00>user</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#75af00>u</span><span style=color:#111>.</span><span style=color:#75af00>hasNext</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>user</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>u</span><span style=color:#111>.</span><span style=color:#75af00>users</span><span style=color:#111>[</span><span style=color:#75af00>u</span><span style=color:#111>.</span><span style=color:#75af00>index</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>u</span><span style=color:#111>.</span><span style=color:#75af00>index</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#75af00>user</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#00a8c8>nil</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>user</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>name</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>age</span>  <span style=color:#00a8c8>int</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>user1</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>user</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>name</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;a&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>age</span><span style=color:#111>:</span>  <span style=color:#ae81ff>30</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>user2</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>user</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>name</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;b&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>age</span><span style=color:#111>:</span>  <span style=color:#ae81ff>20</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>userCollection</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>userCollection</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>users</span><span style=color:#111>:</span> <span style=color:#111>[]</span><span style=color:#f92672>*</span><span style=color:#75af00>user</span><span style=color:#111>{</span><span style=color:#75af00>user1</span><span style=color:#111>,</span> <span style=color:#75af00>user2</span><span style=color:#111>},</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>iterator</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>userCollection</span><span style=color:#111>.</span><span style=color:#75af00>createIterator</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#75af00>iterator</span><span style=color:#111>.</span><span style=color:#75af00>hasNext</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>user</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>iterator</span><span style=color:#111>.</span><span style=color:#75af00>getNext</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;User is %+v\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>user</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>User is &amp;{name:a age:30}
</span></span></span><span style=display:flex><span><span style=color:#75715e>User is &amp;{name:b age:20}
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div><h2 id=访问者模式>访问者模式</h2><p>访问者模式可以给一系列对象透明的添加功能，并且把相关代码封装到一个类中。</p><p>对象只要预留访问者接口<code>Accept</code>则后期为对象添加功能的时候就不需要改动对象。</p><h3 id=代码实现-7>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Customer</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Accept</span><span style=color:#111>(</span><span style=color:#75af00>Visitor</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Visitor</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Visit</span><span style=color:#111>(</span><span style=color:#75af00>Customer</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>EnterpriseCustomer</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>name</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>CustomerCol</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>customers</span> <span style=color:#111>[]</span><span style=color:#75af00>Customer</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>CustomerCol</span><span style=color:#111>)</span> <span style=color:#75af00>Add</span><span style=color:#111>(</span><span style=color:#75af00>customer</span> <span style=color:#75af00>Customer</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>customers</span> <span style=color:#111>=</span> <span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>customers</span><span style=color:#111>,</span> <span style=color:#75af00>customer</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>CustomerCol</span><span style=color:#111>)</span> <span style=color:#75af00>Accept</span><span style=color:#111>(</span><span style=color:#75af00>visitor</span> <span style=color:#75af00>Visitor</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#75af00>_</span><span style=color:#111>,</span> <span style=color:#75af00>customer</span> <span style=color:#f92672>:=</span> <span style=color:#00a8c8>range</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>customers</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>customer</span><span style=color:#111>.</span><span style=color:#75af00>Accept</span><span style=color:#111>(</span><span style=color:#75af00>visitor</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>NewEnterpriseCustomer</span><span style=color:#111>(</span><span style=color:#75af00>name</span> <span style=color:#00a8c8>string</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>EnterpriseCustomer</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>EnterpriseCustomer</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>name</span><span style=color:#111>:</span> <span style=color:#75af00>name</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>EnterpriseCustomer</span><span style=color:#111>)</span> <span style=color:#75af00>Accept</span><span style=color:#111>(</span><span style=color:#75af00>visitor</span> <span style=color:#75af00>Visitor</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>visitor</span><span style=color:#111>.</span><span style=color:#75af00>Visit</span><span style=color:#111>(</span><span style=color:#75af00>c</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>IndividualCustomer</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>name</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>NewIndividualCustomer</span><span style=color:#111>(</span><span style=color:#75af00>name</span> <span style=color:#00a8c8>string</span><span style=color:#111>)</span> <span style=color:#f92672>*</span><span style=color:#75af00>IndividualCustomer</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>IndividualCustomer</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>name</span><span style=color:#111>:</span> <span style=color:#75af00>name</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>IndividualCustomer</span><span style=color:#111>)</span> <span style=color:#75af00>Accept</span><span style=color:#111>(</span><span style=color:#75af00>visitor</span> <span style=color:#75af00>Visitor</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>visitor</span><span style=color:#111>.</span><span style=color:#75af00>Visit</span><span style=color:#111>(</span><span style=color:#75af00>c</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>ServiceRequestVisitor</span> <span style=color:#00a8c8>struct</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#75af00>ServiceRequestVisitor</span><span style=color:#111>)</span> <span style=color:#75af00>Visit</span><span style=color:#111>(</span><span style=color:#75af00>customer</span> <span style=color:#75af00>Customer</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>switch</span> <span style=color:#75af00>c</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>customer</span><span style=color:#111>.(</span><span style=color:#00a8c8>type</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>case</span> <span style=color:#f92672>*</span><span style=color:#75af00>EnterpriseCustomer</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;serving enterprise customer %s\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>name</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>case</span> <span style=color:#f92672>*</span><span style=color:#75af00>IndividualCustomer</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;serving individual customer %s\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>name</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// only for enterprise</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>AnalysisVisitor</span> <span style=color:#00a8c8>struct</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#75af00>AnalysisVisitor</span><span style=color:#111>)</span> <span style=color:#75af00>Visit</span><span style=color:#111>(</span><span style=color:#75af00>customer</span> <span style=color:#75af00>Customer</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>switch</span> <span style=color:#75af00>c</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>customer</span><span style=color:#111>.(</span><span style=color:#00a8c8>type</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>case</span> <span style=color:#f92672>*</span><span style=color:#75af00>EnterpriseCustomer</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;analysis enterprise customer %s\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>name</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>CustomerCol</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Add</span><span style=color:#111>(</span><span style=color:#75af00>NewEnterpriseCustomer</span><span style=color:#111>(</span><span style=color:#d88200>&#34;A company&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Add</span><span style=color:#111>(</span><span style=color:#75af00>NewEnterpriseCustomer</span><span style=color:#111>(</span><span style=color:#d88200>&#34;B company&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Add</span><span style=color:#111>(</span><span style=color:#75af00>NewIndividualCustomer</span><span style=color:#111>(</span><span style=color:#d88200>&#34;bob&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Accept</span><span style=color:#111>(</span><span style=color:#f92672>&amp;</span><span style=color:#75af00>ServiceRequestVisitor</span><span style=color:#111>{})</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span> <span style=color:#111>=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>CustomerCol</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Add</span><span style=color:#111>(</span><span style=color:#75af00>NewEnterpriseCustomer</span><span style=color:#111>(</span><span style=color:#d88200>&#34;A company&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Add</span><span style=color:#111>(</span><span style=color:#75af00>NewIndividualCustomer</span><span style=color:#111>(</span><span style=color:#d88200>&#34;bob&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Add</span><span style=color:#111>(</span><span style=color:#75af00>NewEnterpriseCustomer</span><span style=color:#111>(</span><span style=color:#d88200>&#34;B company&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Accept</span><span style=color:#111>(</span><span style=color:#f92672>&amp;</span><span style=color:#75af00>AnalysisVisitor</span><span style=color:#111>{})</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>serving enterprise customer A company
</span></span></span><span style=display:flex><span><span style=color:#75715e>serving enterprise customer B company
</span></span></span><span style=display:flex><span><span style=color:#75715e>serving individual customer bob
</span></span></span><span style=display:flex><span><span style=color:#75715e>analysis enterprise customer A company
</span></span></span><span style=display:flex><span><span style=color:#75715e>analysis enterprise customer B company
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div><h2 id=备忘录模式>备忘录模式</h2><p>备忘录模式用于保存程序内部状态到外部，又不希望暴露内部状态的情形。</p><p>程序内部状态使用窄接口传递给外部进行存储，从而不暴露程序实现细节。</p><p>备忘录模式同时可以离线保存内部状态，如保存到数据库，文件等。</p><h3 id=代码实现-8>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Memento</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Game</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>hp</span><span style=color:#111>,</span> <span style=color:#75af00>mp</span> <span style=color:#00a8c8>int</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>gameMemento</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>hp</span><span style=color:#111>,</span> <span style=color:#75af00>mp</span> <span style=color:#00a8c8>int</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>g</span> <span style=color:#f92672>*</span><span style=color:#75af00>Game</span><span style=color:#111>)</span> <span style=color:#75af00>Play</span><span style=color:#111>(</span><span style=color:#75af00>mpDelta</span><span style=color:#111>,</span> <span style=color:#75af00>hpDelta</span> <span style=color:#00a8c8>int</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>g</span><span style=color:#111>.</span><span style=color:#75af00>mp</span> <span style=color:#f92672>+=</span> <span style=color:#75af00>mpDelta</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>g</span><span style=color:#111>.</span><span style=color:#75af00>hp</span> <span style=color:#f92672>+=</span> <span style=color:#75af00>hpDelta</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>g</span> <span style=color:#f92672>*</span><span style=color:#75af00>Game</span><span style=color:#111>)</span> <span style=color:#75af00>Save</span><span style=color:#111>()</span> <span style=color:#75af00>Memento</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>gameMemento</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>hp</span><span style=color:#111>:</span> <span style=color:#75af00>g</span><span style=color:#111>.</span><span style=color:#75af00>hp</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>mp</span><span style=color:#111>:</span> <span style=color:#75af00>g</span><span style=color:#111>.</span><span style=color:#75af00>mp</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>g</span> <span style=color:#f92672>*</span><span style=color:#75af00>Game</span><span style=color:#111>)</span> <span style=color:#75af00>Load</span><span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#75af00>Memento</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>gm</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>m</span><span style=color:#111>.(</span><span style=color:#f92672>*</span><span style=color:#75af00>gameMemento</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>g</span><span style=color:#111>.</span><span style=color:#75af00>mp</span> <span style=color:#111>=</span> <span style=color:#75af00>gm</span><span style=color:#111>.</span><span style=color:#75af00>mp</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>g</span><span style=color:#111>.</span><span style=color:#75af00>hp</span> <span style=color:#111>=</span> <span style=color:#75af00>gm</span><span style=color:#111>.</span><span style=color:#75af00>hp</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>g</span> <span style=color:#f92672>*</span><span style=color:#75af00>Game</span><span style=color:#111>)</span> <span style=color:#75af00>Status</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Current HP:%d, MP:%d\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>g</span><span style=color:#111>.</span><span style=color:#75af00>hp</span><span style=color:#111>,</span> <span style=color:#75af00>g</span><span style=color:#111>.</span><span style=color:#75af00>mp</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>game</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>Game</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>hp</span><span style=color:#111>:</span> <span style=color:#ae81ff>10</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>mp</span><span style=color:#111>:</span> <span style=color:#ae81ff>10</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>game</span><span style=color:#111>.</span><span style=color:#75af00>Status</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>progress</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>game</span><span style=color:#111>.</span><span style=color:#75af00>Save</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>game</span><span style=color:#111>.</span><span style=color:#75af00>Play</span><span style=color:#111>(</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#111>,</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>game</span><span style=color:#111>.</span><span style=color:#75af00>Status</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>game</span><span style=color:#111>.</span><span style=color:#75af00>Load</span><span style=color:#111>(</span><span style=color:#75af00>progress</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>game</span><span style=color:#111>.</span><span style=color:#75af00>Status</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>Current HP:10, MP:10
</span></span></span><span style=display:flex><span><span style=color:#75715e>Current HP:7, MP:8
</span></span></span><span style=display:flex><span><span style=color:#75715e>Current HP:10, MP:10
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div><h2 id=解释器模式>解释器模式</h2><p>解释器模式定义一套语言文法，并设计该语言解释器，使用户能使用特定文法控制解释器行为。</p><p>解释器模式的意义在于，它分离多种复杂功能的实现，每个功能只需关注自身的解释。</p><p>对于调用者不用关心内部的解释器的工作，只需要用简单的方式组合命令就可以。</p><h3 id=代码实现-9>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>(</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;strconv&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;strings&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Node</span> <span style=color:#00a8c8>interface</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Interpret</span><span style=color:#111>()</span> <span style=color:#00a8c8>int</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>ValNode</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>val</span> <span style=color:#00a8c8>int</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>n</span> <span style=color:#f92672>*</span><span style=color:#75af00>ValNode</span><span style=color:#111>)</span> <span style=color:#75af00>Interpret</span><span style=color:#111>()</span> <span style=color:#00a8c8>int</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>n</span><span style=color:#111>.</span><span style=color:#75af00>val</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>AddNode</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>left</span><span style=color:#111>,</span> <span style=color:#75af00>right</span> <span style=color:#75af00>Node</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>n</span> <span style=color:#f92672>*</span><span style=color:#75af00>AddNode</span><span style=color:#111>)</span> <span style=color:#75af00>Interpret</span><span style=color:#111>()</span> <span style=color:#00a8c8>int</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>n</span><span style=color:#111>.</span><span style=color:#75af00>left</span><span style=color:#111>.</span><span style=color:#75af00>Interpret</span><span style=color:#111>()</span> <span style=color:#f92672>+</span> <span style=color:#75af00>n</span><span style=color:#111>.</span><span style=color:#75af00>right</span><span style=color:#111>.</span><span style=color:#75af00>Interpret</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>MinNode</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>left</span><span style=color:#111>,</span> <span style=color:#75af00>right</span> <span style=color:#75af00>Node</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>n</span> <span style=color:#f92672>*</span><span style=color:#75af00>MinNode</span><span style=color:#111>)</span> <span style=color:#75af00>Interpret</span><span style=color:#111>()</span> <span style=color:#00a8c8>int</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>n</span><span style=color:#111>.</span><span style=color:#75af00>left</span><span style=color:#111>.</span><span style=color:#75af00>Interpret</span><span style=color:#111>()</span> <span style=color:#f92672>-</span> <span style=color:#75af00>n</span><span style=color:#111>.</span><span style=color:#75af00>right</span><span style=color:#111>.</span><span style=color:#75af00>Interpret</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Parser</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>exp</span>   <span style=color:#111>[]</span><span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>index</span> <span style=color:#00a8c8>int</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>prev</span>  <span style=color:#75af00>Node</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>p</span> <span style=color:#f92672>*</span><span style=color:#75af00>Parser</span><span style=color:#111>)</span> <span style=color:#75af00>Parse</span><span style=color:#111>(</span><span style=color:#75af00>exp</span> <span style=color:#00a8c8>string</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>exp</span> <span style=color:#111>=</span> <span style=color:#75af00>strings</span><span style=color:#111>.</span><span style=color:#75af00>Split</span><span style=color:#111>(</span><span style=color:#75af00>exp</span><span style=color:#111>,</span> <span style=color:#d88200>&#34; &#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>if</span> <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>index</span> <span style=color:#f92672>&gt;=</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>exp</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>			<span style=color:#00a8c8>return</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>switch</span> <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>exp</span><span style=color:#111>[</span><span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>index</span><span style=color:#111>]</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>case</span> <span style=color:#d88200>&#34;+&#34;</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>prev</span> <span style=color:#111>=</span> <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>newAddNode</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>case</span> <span style=color:#d88200>&#34;-&#34;</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>prev</span> <span style=color:#111>=</span> <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>newMinNode</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>default</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>			<span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>prev</span> <span style=color:#111>=</span> <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>newValNode</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>		<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>p</span> <span style=color:#f92672>*</span><span style=color:#75af00>Parser</span><span style=color:#111>)</span> <span style=color:#75af00>newAddNode</span><span style=color:#111>()</span> <span style=color:#75af00>Node</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>index</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>AddNode</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>left</span><span style=color:#111>:</span>  <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>prev</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>right</span><span style=color:#111>:</span> <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>newValNode</span><span style=color:#111>(),</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>p</span> <span style=color:#f92672>*</span><span style=color:#75af00>Parser</span><span style=color:#111>)</span> <span style=color:#75af00>newMinNode</span><span style=color:#111>()</span> <span style=color:#75af00>Node</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>index</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>MinNode</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>left</span><span style=color:#111>:</span>  <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>prev</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>right</span><span style=color:#111>:</span> <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>newValNode</span><span style=color:#111>(),</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>p</span> <span style=color:#f92672>*</span><span style=color:#75af00>Parser</span><span style=color:#111>)</span> <span style=color:#75af00>newValNode</span><span style=color:#111>()</span> <span style=color:#75af00>Node</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>v</span><span style=color:#111>,</span> <span style=color:#75af00>_</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>strconv</span><span style=color:#111>.</span><span style=color:#75af00>Atoi</span><span style=color:#111>(</span><span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>exp</span><span style=color:#111>[</span><span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>index</span><span style=color:#111>])</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>index</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>ValNode</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>val</span><span style=color:#111>:</span> <span style=color:#75af00>v</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>p</span> <span style=color:#f92672>*</span><span style=color:#75af00>Parser</span><span style=color:#111>)</span> <span style=color:#75af00>Result</span><span style=color:#111>()</span> <span style=color:#75af00>Node</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>prev</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>p</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>Parser</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>Parse</span><span style=color:#111>(</span><span style=color:#d88200>&#34;1 + 2 + 3 - 4 + 5 - 6&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>res</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>p</span><span style=color:#111>.</span><span style=color:#75af00>Result</span><span style=color:#111>().</span><span style=color:#75af00>Interpret</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>expect</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#75af00>res</span> <span style=color:#f92672>!=</span> <span style=color:#75af00>expect</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#75af00>res</span><span style=color:#111>,</span><span style=color:#75af00>expect</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><h2 id=中介模式>中介模式</h2><p>中介者模式封装对象之间互交，使依赖变的简单，并且使复杂互交简单化，封装在中介者中。</p><p>例子中的中介者使用单例模式生成中介者。</p><p>中介者的change使用switch判断类型。</p><h3 id=代码实现-10>代码实现</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#75af00>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>(</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d88200>&#34;strings&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>CDDriver</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Data</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>CDDriver</span><span style=color:#111>)</span> <span style=color:#75af00>ReadData</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Data</span> <span style=color:#111>=</span> <span style=color:#d88200>&#34;music,image&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;CDDriver: reading data %s\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Data</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>GetMediatorInstance</span><span style=color:#111>().</span><span style=color:#75af00>changed</span><span style=color:#111>(</span><span style=color:#75af00>c</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>CPU</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Video</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Sound</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>c</span> <span style=color:#f92672>*</span><span style=color:#75af00>CPU</span><span style=color:#111>)</span> <span style=color:#75af00>Process</span><span style=color:#111>(</span><span style=color:#75af00>data</span> <span style=color:#00a8c8>string</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>sp</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>strings</span><span style=color:#111>.</span><span style=color:#75af00>Split</span><span style=color:#111>(</span><span style=color:#75af00>data</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;,&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Sound</span> <span style=color:#111>=</span> <span style=color:#75af00>sp</span><span style=color:#111>[</span><span style=color:#ae81ff>0</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Video</span> <span style=color:#111>=</span> <span style=color:#75af00>sp</span><span style=color:#111>[</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;CPU: split data with Sound %s, Video %s\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Sound</span><span style=color:#111>,</span> <span style=color:#75af00>c</span><span style=color:#111>.</span><span style=color:#75af00>Video</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>GetMediatorInstance</span><span style=color:#111>().</span><span style=color:#75af00>changed</span><span style=color:#111>(</span><span style=color:#75af00>c</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>VideoCard</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Data</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>v</span> <span style=color:#f92672>*</span><span style=color:#75af00>VideoCard</span><span style=color:#111>)</span> <span style=color:#75af00>Display</span><span style=color:#111>(</span><span style=color:#75af00>data</span> <span style=color:#00a8c8>string</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>v</span><span style=color:#111>.</span><span style=color:#75af00>Data</span> <span style=color:#111>=</span> <span style=color:#75af00>data</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;VideoCard: display %s\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>v</span><span style=color:#111>.</span><span style=color:#75af00>Data</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>GetMediatorInstance</span><span style=color:#111>().</span><span style=color:#75af00>changed</span><span style=color:#111>(</span><span style=color:#75af00>v</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>SoundCard</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Data</span> <span style=color:#00a8c8>string</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>s</span> <span style=color:#f92672>*</span><span style=color:#75af00>SoundCard</span><span style=color:#111>)</span> <span style=color:#75af00>Play</span><span style=color:#111>(</span><span style=color:#75af00>data</span> <span style=color:#00a8c8>string</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>s</span><span style=color:#111>.</span><span style=color:#75af00>Data</span> <span style=color:#111>=</span> <span style=color:#75af00>data</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;SoundCard: play %s\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>s</span><span style=color:#111>.</span><span style=color:#75af00>Data</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>GetMediatorInstance</span><span style=color:#111>().</span><span style=color:#75af00>changed</span><span style=color:#111>(</span><span style=color:#75af00>s</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>type</span> <span style=color:#75af00>Mediator</span> <span style=color:#00a8c8>struct</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>CD</span>    <span style=color:#f92672>*</span><span style=color:#75af00>CDDriver</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>CPU</span>   <span style=color:#f92672>*</span><span style=color:#75af00>CPU</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Video</span> <span style=color:#f92672>*</span><span style=color:#75af00>VideoCard</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>Sound</span> <span style=color:#f92672>*</span><span style=color:#75af00>SoundCard</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>var</span> <span style=color:#75af00>mediator</span> <span style=color:#f92672>*</span><span style=color:#75af00>Mediator</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>GetMediatorInstance</span><span style=color:#111>()</span> <span style=color:#f92672>*</span><span style=color:#75af00>Mediator</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#75af00>mediator</span> <span style=color:#f92672>==</span> <span style=color:#00a8c8>nil</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>mediator</span> <span style=color:#111>=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>Mediator</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#75af00>mediator</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#111>(</span><span style=color:#75af00>m</span> <span style=color:#f92672>*</span><span style=color:#75af00>Mediator</span><span style=color:#111>)</span> <span style=color:#75af00>changed</span><span style=color:#111>(</span><span style=color:#75af00>i</span> <span style=color:#00a8c8>interface</span><span style=color:#111>{})</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>switch</span> <span style=color:#75af00>inst</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>i</span><span style=color:#111>.(</span><span style=color:#00a8c8>type</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>case</span> <span style=color:#f92672>*</span><span style=color:#75af00>CDDriver</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>CPU</span><span style=color:#111>.</span><span style=color:#75af00>Process</span><span style=color:#111>(</span><span style=color:#75af00>inst</span><span style=color:#111>.</span><span style=color:#75af00>Data</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>case</span> <span style=color:#f92672>*</span><span style=color:#75af00>CPU</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>Sound</span><span style=color:#111>.</span><span style=color:#75af00>Play</span><span style=color:#111>(</span><span style=color:#75af00>inst</span><span style=color:#111>.</span><span style=color:#75af00>Sound</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>		<span style=color:#75af00>m</span><span style=color:#111>.</span><span style=color:#75af00>Video</span><span style=color:#111>.</span><span style=color:#75af00>Display</span><span style=color:#111>(</span><span style=color:#75af00>inst</span><span style=color:#111>.</span><span style=color:#75af00>Video</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>func</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>mediator</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>GetMediatorInstance</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>mediator</span><span style=color:#111>.</span><span style=color:#75af00>CD</span> <span style=color:#111>=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>CDDriver</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>mediator</span><span style=color:#111>.</span><span style=color:#75af00>CPU</span> <span style=color:#111>=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>CPU</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>mediator</span><span style=color:#111>.</span><span style=color:#75af00>Video</span> <span style=color:#111>=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>VideoCard</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>mediator</span><span style=color:#111>.</span><span style=color:#75af00>Sound</span> <span style=color:#111>=</span> <span style=color:#f92672>&amp;</span><span style=color:#75af00>SoundCard</span><span style=color:#111>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//Tiggle</span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>mediator</span><span style=color:#111>.</span><span style=color:#75af00>CD</span><span style=color:#111>.</span><span style=color:#75af00>ReadData</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;%#v\n&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>mediator</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>CDDriver: reading data music,image
</span></span></span><span style=display:flex><span><span style=color:#75715e>CPU: split data with Sound music, Video image
</span></span></span><span style=display:flex><span><span style=color:#75715e>SoundCard: play music
</span></span></span><span style=display:flex><span><span style=color:#75715e>VideoCard: display image
</span></span></span><span style=display:flex><span><span style=color:#75715e>&amp;main.Mediator{CD:(*main.CDDriver)(0xc000010250), CPU:(*main.CPU)(0xc000060040), Video:(*main.VideoCard)(0xc000010260), Sound:(*main.SoundCard)(0xc000010270)}
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div><h2 id=references>References</h2><p><a href=https://github.com/senghoo/golang-design-pattern>https://github.com/senghoo/golang-design-pattern</a></p><p><a href=https://refactoringguru.cn/design-patterns>https://refactoringguru.cn/design-patterns</a></p><p><a href=https://lailin.xyz/post/singleton.html>https://lailin.xyz/post/singleton.html</a></p></div><footer class=post-footer><div class=post-license><p><strong>Article Title:</strong> 行为模式</p><p><strong>Author:</strong> daemon365</p><p><strong>Permalink:</strong> <a href=https://daemon365.dev/post/go/behavioral_patterns/>https://daemon365.dev/post/go/behavioral_patterns/</a></p><p><strong>License:</strong> This article is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>BY-NC-SA</a>. Please cite the source when reposting.</p></div><nav class=post-navigation><a href=/post/go/structural_patterns/ class=nav-prev><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg><div><span class=nav-label>Previous</span>
<span class=nav-title>结构型模式</span></div></a><a href=/post/cloud/kubernetes_container_device_interface_cdi/ class=nav-next><div><span class=nav-label>Next</span>
<span class=nav-title>kubernetes container device interface (CDI)</span></div><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></a></nav><div class=post-comments><script src=https://utteranc.es/client.js repo=daemon365/blog issue-term=pathname label=comments theme=preferred-color-scheme crossorigin=anonymous async></script></div></footer></article></div></div><div class=toc-float-button id=tocButton><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5.0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5.0 014 19.5v-15A2.5 2.5.0 016.5 2z"/></svg></div><div class=toc-panel id=tocPanel><div class=toc-panel-header><h3 class=toc-panel-title>Table of Contents</h3><button class=toc-panel-close id=tocClose>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div><nav class=toc-panel-nav id=TableOfContents><nav id=TableOfContents><ul><li><a href=#责任链模式>责任链模式</a><ul><li><a href=#代码实现>代码实现</a></li></ul></li><li><a href=#观察者模式>观察者模式</a><ul><li><a href=#代码实现-1>代码实现</a></li></ul></li><li><a href=#模板方法模式>模板方法模式</a><ul><li><a href=#代码实现-2>代码实现</a></li></ul></li><li><a href=#命令模式>命令模式</a><ul><li><a href=#代码实现-3>代码实现</a></li></ul></li><li><a href=#策略模式>策略模式</a><ul><li><a href=#代码实现-4>代码实现</a></li></ul></li><li><a href=#状态模式>状态模式</a><ul><li><a href=#代码实现-5>代码实现</a></li></ul></li><li><a href=#迭代器模式>迭代器模式</a><ul><li><a href=#代码实现-6>代码实现</a></li></ul></li><li><a href=#访问者模式>访问者模式</a><ul><li><a href=#代码实现-7>代码实现</a></li></ul></li><li><a href=#备忘录模式>备忘录模式</a><ul><li><a href=#代码实现-8>代码实现</a></li></ul></li><li><a href=#解释器模式>解释器模式</a><ul><li><a href=#代码实现-9>代码实现</a></li></ul></li><li><a href=#中介模式>中介模式</a><ul><li><a href=#代码实现-10>代码实现</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></nav></div></main><footer class=site-footer><div class=container><div class=footer-content><div class=footer-info><p class=copyright>© 2025 daemon365</p><p class=powered-by>Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/daemon365/hugo-theme-daemon target=_blank rel=noopener>Daemon</a></p></div><div class=social-links><a href=https://github.com/daemon365 target=_blank rel=noopener aria-label=GitHub><svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a href=mailto:daemon365@foxmail.com aria-label=Email><svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></div></div></div></footer><div class=search-modal id=searchModal><div class=search-modal-backdrop></div><div class=search-modal-content><div class=search-modal-header><input type=text class=search-input id=searchInput placeholder="Search articles..." autofocus>
<button class=search-close aria-label="Close search">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div><div class=search-results id=searchResults><p class=search-hint>Enter 2 or more characters to start searching</p></div></div></div><script src=/js/components/search.js></script><script src=/js/components/toc.js></script><script src=/js/components/scroll-effects.js></script><script src=/js/components/code-copy.js></script><script src=/js/components/lazy-loading.js></script><script src=/js/components/image-preview.js></script><script src=/js/components/back-to-top.js></script><script src=/js/main-new.js></script><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker registered:",e.scope)}).catch(e=>{console.log("Service Worker registration failed:",e)})})</script></body></html>