<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.139.4"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/favicon.ico><meta itemprop=name content="golang操作etcd"><meta itemprop=description content="Don't let yourself stop."><meta name=description content="Don't let yourself stop."><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://daemon365.dev/imgs/daemon365.png"><meta itemprop=keywords content="boltdb,etcd,golang,数据库,kubernetes"><meta property="og:type" content="article"><meta property="og:title" content="golang操作etcd"><meta property="og:description" content="Don't let yourself stop."><meta property="og:image" content="/imgs/daemon365.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://daemon365.dev/post/go/golang_operates_etcd/"><meta property="og:site_name" content="Daemon"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="daemon365"><meta property="article:published_time" content="2023-01-08 20:56:00 +0800 +0800"><meta property="article:modified_time" content="2023-01-08 20:56:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://daemon365.dev/3rd/font-awesome/6.6.0/css/all.min.css><link type=text/css rel=stylesheet href=https://daemon365.dev/3rd/animate.css/4.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://daemon365.dev/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href=/css/main.min.5ec1f63635756d664e619fe2d87a11c7394f519beff240c124743433c9861792.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"golang_operates_etcd","permalink":"https://daemon365.dev/post/go/golang_operates_etcd/","title":"golang操作etcd","waline":{"js":[{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"2.15.8"},{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.id="LA_COLLECT",e.src="https://sdk.51.la/js-sdk-pro.min.js",e.async="true",e.onload=function(){LA.init({id:"JmAHxEAUVgyS8B1c",ck:"JmAHxEAUVgyS8B1c",autoTrack:!0})},document.head.appendChild(e)})</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>golang操作etcd - Daemon</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Daemon</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Don't let yourself stop.</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>Home</a></li><li class="menu-item menu-item-about"><a href=/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>About</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>Archives</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>Commonweal</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#etcd介绍>etcd介绍</a></li><li><a href=#etcd应用场景>etcd应用场景</a><ul><li><a href=#服务发现>服务发现</a></li><li><a href=#配置中心>配置中心</a></li><li><a href=#分布式锁>分布式锁</a></li></ul></li><li><a href=#为什么用-etcd-而不用zookeeper>为什么用 etcd 而不用ZooKeeper？</a><ul><li><a href=#为什么不选择zookeeper>为什么不选择ZooKeeper？</a></li><li><a href=#为什么选择etcd>为什么选择etcd？</a></li></ul></li><li><a href=#etcd集群>etcd集群</a><ul><li><a href=#搭建一个3节点集群示例>搭建一个3节点集群示例：</a></li></ul></li><li><a href=#go语言操作etcd>Go语言操作etcd</a><ul><li><a href=#安装>安装</a></li><li><a href=#put和get操作>put和get操作</a></li><li><a href=#watch操作>watch操作</a></li><li><a href=#lease租约>lease租约</a></li><li><a href=#keepalive>keepAlive</a></li><li><a href=#基于etcd实现分布式锁>基于etcd实现分布式锁</a></li></ul></li><li><a href=#文章转自>文章转自</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=daemon365 src=/imgs/img-lazy-loading.gif data-src=/imgs/daemon365.png><p class=site-author-name itemprop=name>daemon365</p><div class=site-description itemprop=description>Don't let yourself stop.</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>95</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>7</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>52</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/daemon365 title="Github → https://github.com/daemon365" rel=noopener target=_blank><i class="fab fa-github fa-fw"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://go-kratos.dev title=https://go-kratos.dev target=_blank>kratos</a></li></ul></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://daemon365.dev/post/go/golang_operates_etcd/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/daemon365.png"><meta itemprop=name content="daemon365"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="daemon365"><meta itemprop=description content="Don't let yourself stop."></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="golang操作etcd"><meta itemprop=description content="etcd是近几年比较火热的一个开源的、分布式的键值对数据存储系统，提供共享配置、服务的注册和发现，本文主要介绍etcd的安装和使用。
etcd介绍



    etcd
    
    
    
是使用Go语言开发的一个开源的、高可用的分布式key-value存储系统，可以用于配置共享和服务的注册和发现。"></span><header class=post-header><h1 class=post-title itemprop="name headline">golang操作etcd</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023-01-08 20:56:00 +0800 +0800" itemprop="dateCreated datePublished" datetime="2023-01-08 20:56:00 +0800 +0800">2023-01-08
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/go itemprop=url rel=index><span itemprop=name>go</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>2794</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>6分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/go/golang_operates_etcd/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>etcd是近几年比较火热的一个开源的、分布式的键值对数据存储系统，提供共享配置、服务的注册和发现，本文主要介绍etcd的安装和使用。</p><h2 id=etcd介绍>etcd介绍
<a class=header-anchor href=#etcd%e4%bb%8b%e7%bb%8d></a></h2><p><a href=https://etcd.io/ title=etcd rel="noopener external nofollow noreferrer" target=_blank class=exturl>etcd
<i class="fa fa-external-link-alt"></i>
</a>是使用Go语言开发的一个开源的、高可用的分布式key-value存储系统，可以用于配置共享和服务的注册和发现。</p><p>类似项目有zookeeper和consul。</p><p>etcd具有以下特点：</p><ul><li>完全复制：集群中的每个节点都可以使用完整的存档</li><li>高可用性：Etcd可用于避免硬件的单点故障或网络问题</li><li>一致性：每次读取都会返回跨多主机的最新写入</li><li>简单：包括一个定义良好、面向用户的API（gRPC）</li><li>安全：实现了带有可选的客户端证书身份验证的自动化TLS</li><li>快速：每秒10000次写入的基准速度</li><li>可靠：使用Raft算法实现了强一致、高可用的服务存储目录</li></ul><h2 id=etcd应用场景>etcd应用场景
<a class=header-anchor href=#etcd%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af></a></h2><h3 id=服务发现>服务发现
<a class=header-anchor href=#%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0></a></h3><p>服务发现要解决的也是分布式系统中最常见的问题之一，即在同一个分布式集群中的进程或服务，要如何才能找到对方并建立连接。本质上来说，服务发现就是想要了解集群中是否有进程在监听 udp 或 tcp 端口，并且通过名字就可以查找和连接。</p><h3 id=配置中心>配置中心
<a class=header-anchor href=#%e9%85%8d%e7%bd%ae%e4%b8%ad%e5%bf%83></a></h3><p>将一些配置信息放到 etcd 上进行集中管理。</p><p>这类场景的使用方式通常是这样：应用在启动的时候主动从 etcd 获取一次配置信息，同时，在 etcd 节点上注册一个 Watcher 并等待，以后每次配置有更新的时候，etcd 都会实时通知订阅者，以此达到获取最新配置信息的目的。</p><h3 id=分布式锁>分布式锁
<a class=header-anchor href=#%e5%88%86%e5%b8%83%e5%bc%8f%e9%94%81></a></h3><p>因为 etcd 使用 Raft 算法保持了数据的强一致性，某次操作存储到集群中的值必然是全局一致的，所以很容易实现分布式锁。锁服务有两种使用方式，一是保持独占，二是控制时序。</p><ul><li><strong>保持独占即所有获取锁的用户最终只有一个可以得到</strong>。etcd 为此提供了一套实现分布式锁原子操作 CAS（CompareAndSwap）的 API。通过设置prevExist值，可以保证在多个节点同时去创建某个目录时，只有一个成功。而创建成功的用户就可以认为是获得了锁。</li><li>控制时序，即所有想要获得锁的用户都会被安排执行，但是<strong>获得锁的顺序也是全局唯一的，同时决定了执行顺序</strong>。etcd 为此也提供了一套 API（自动创建有序键），对一个目录建值时指定为POST动作，这样 etcd 会自动在目录下生成一个当前最大的值为键，存储这个新的值（客户端编号）。同时还可以使用 API 按顺序列出所有当前目录下的键值。此时这些键的值就是客户端的时序，而这些键中存储的值可以是代表客户端的编号。</li></ul><h2 id=为什么用-etcd-而不用zookeeper>为什么用 etcd 而不用ZooKeeper？
<a class=header-anchor href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e7%94%a8-etcd-%e8%80%8c%e4%b8%8d%e7%94%a8zookeeper></a></h2><p>etcd 实现的这些功能，ZooKeeper都能实现。那么为什么要用 etcd 而非直接使用ZooKeeper呢？</p><h3 id=为什么不选择zookeeper>为什么不选择ZooKeeper？
<a class=header-anchor href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%8d%e9%80%89%e6%8b%a9zookeeper></a></h3><ol><li>部署维护复杂，其使用的Paxos强一致性算法复杂难懂。官方只提供了Java和C两种语言的接口。</li><li>使用Java编写引入大量的依赖。运维人员维护起来比较麻烦。</li><li>最近几年发展缓慢，不如etcd和consul等后起之秀。</li></ol><h3 id=为什么选择etcd>为什么选择etcd？
<a class=header-anchor href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%80%89%e6%8b%a9etcd></a></h3><ol><li>简单。使用 Go 语言编写部署简单；支持HTTP/JSON API,使用简单；使用 Raft 算法保证强一致性让用户易于理解。</li><li>etcd 默认数据一更新就进行持久化。</li><li>etcd 支持 SSL 客户端安全认证。</li></ol><p>最后，etcd 作为一个年轻的项目，正在高速迭代和开发中，这既是一个优点，也是一个缺点。优点是它的未来具有无限的可能性，缺点是无法得到大项目长时间使用的检验。然而，目前CoreOS、Kubernetes和CloudFoundry等知名项目均在生产环境中使用了etcd，所以总的来说，etcd值得你去尝试。</p><h2 id=etcd集群>etcd集群
<a class=header-anchor href=#etcd%e9%9b%86%e7%be%a4></a></h2><p>etcd 作为一个高可用键值存储系统，天生就是为集群化而设计的。由于 Raft 算法在做决策时需要多数节点的投票，所以 etcd 一般部署集群推荐奇数个节点，推荐的数量为 3、5 或者 7 个节点构成一个集群。</p><h3 id=搭建一个3节点集群示例>搭建一个3节点集群示例：
<a class=header-anchor href=#%e6%90%ad%e5%bb%ba%e4%b8%80%e4%b8%aa3%e8%8a%82%e7%82%b9%e9%9b%86%e7%be%a4%e7%a4%ba%e4%be%8b></a></h3><p>在每个etcd节点指定集群成员，为了区分不同的集群最好同时配置一个独一无二的token。</p><p>下面是提前定义好的集群信息，其中n1、n2和n3表示3个不同的etcd节点。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>TOKEN=token-01
</span></span><span style=display:flex><span>CLUSTER_STATE=new
</span></span><span style=display:flex><span>CLUSTER=n1=http://10.240.0.17:2380,n2=http://10.240.0.18:2380,n3=http://10.240.0.19:2380
</span></span></code></pre></div><p>在n1这台机器上执行以下命令来启动etcd：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>etcd --data-dir=data.etcd --name n1 \
</span></span><span style=display:flex><span>	--initial-advertise-peer-urls http://10.240.0.17:2380 --listen-peer-urls http://10.240.0.17:2380 \
</span></span><span style=display:flex><span>	--advertise-client-urls http://10.240.0.17:2379 --listen-client-urls http://10.240.0.17:2379 \
</span></span><span style=display:flex><span>	--initial-cluster ${CLUSTER} \
</span></span><span style=display:flex><span>	--initial-cluster-state ${CLUSTER_STATE} --initial-cluster-token ${TOKEN}
</span></span></code></pre></div><p>在n2这台机器上执行以下命令启动etcd：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>etcd --data-dir=data.etcd --name n2 \
</span></span><span style=display:flex><span>	--initial-advertise-peer-urls http://10.240.0.18:2380 --listen-peer-urls http://10.240.0.18:2380 \
</span></span><span style=display:flex><span>	--advertise-client-urls http://10.240.0.18:2379 --listen-client-urls http://10.240.0.18:2379 \
</span></span><span style=display:flex><span>	--initial-cluster ${CLUSTER} \
</span></span><span style=display:flex><span>	--initial-cluster-state ${CLUSTER_STATE} --initial-cluster-token ${TOKEN}
</span></span></code></pre></div><p>在n3这台机器上执行以下命令启动etcd：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>etcd --data-dir=data.etcd --name n3 \
</span></span><span style=display:flex><span>	--initial-advertise-peer-urls http://10.240.0.19:2380 --listen-peer-urls http://10.240.0.19:2380 \
</span></span><span style=display:flex><span>	--advertise-client-urls http://10.240.0.19:2379 --listen-client-urls http://10.240.0.19:2379 \
</span></span><span style=display:flex><span>	--initial-cluster ${CLUSTER} \
</span></span><span style=display:flex><span>	--initial-cluster-state ${CLUSTER_STATE} --initial-cluster-token ${TOKEN}
</span></span></code></pre></div><p>etcd 官网提供了一个可以公网访问的 etcd 存储地址。你可以通过如下命令得到 etcd 服务的目录，并把它作为-discovery参数使用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>curl</span> <span style=color:#a6e22e>https</span>:<span style=color:#75715e>//discovery.etcd.io/new?size=3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>https</span>:<span style=color:#75715e>//discovery.etcd.io/a81b5818e67a6ea83e9d4daea5ecbc92
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>grab</span> <span style=color:#a6e22e>this</span> <span style=color:#a6e22e>token</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>TOKEN</span>=<span style=color:#a6e22e>token</span><span style=color:#f92672>-</span><span style=color:#ae81ff>01</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>CLUSTER_STATE</span>=<span style=color:#a6e22e>new</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>DISCOVERY</span>=<span style=color:#a6e22e>https</span>:<span style=color:#75715e>//discovery.etcd.io/a81b5818e67a6ea83e9d4daea5ecbc92
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>etcd</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>data</span><span style=color:#f92672>-</span><span style=color:#a6e22e>dir</span>=<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>etcd</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>name</span> <span style=color:#a6e22e>n1</span> \
</span></span><span style=display:flex><span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>initial</span><span style=color:#f92672>-</span><span style=color:#a6e22e>advertise</span><span style=color:#f92672>-</span><span style=color:#a6e22e>peer</span><span style=color:#f92672>-</span><span style=color:#a6e22e>urls</span> <span style=color:#a6e22e>http</span>:<span style=color:#75715e>//10.240.0.17:2380 --listen-peer-urls http://10.240.0.17:2380 \
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>advertise</span><span style=color:#f92672>-</span><span style=color:#a6e22e>client</span><span style=color:#f92672>-</span><span style=color:#a6e22e>urls</span> <span style=color:#a6e22e>http</span>:<span style=color:#75715e>//10.240.0.17:2379 --listen-client-urls http://10.240.0.17:2379 \
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>discovery</span> <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#a6e22e>DISCOVERY</span>} \
</span></span><span style=display:flex><span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>initial</span><span style=color:#f92672>-</span><span style=color:#a6e22e>cluster</span><span style=color:#f92672>-</span><span style=color:#a6e22e>state</span> <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#a6e22e>CLUSTER_STATE</span>} <span style=color:#f92672>--</span><span style=color:#a6e22e>initial</span><span style=color:#f92672>-</span><span style=color:#a6e22e>cluster</span><span style=color:#f92672>-</span><span style=color:#a6e22e>token</span> <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#a6e22e>TOKEN</span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>etcd</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>data</span><span style=color:#f92672>-</span><span style=color:#a6e22e>dir</span>=<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>etcd</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>name</span> <span style=color:#a6e22e>n2</span> \
</span></span><span style=display:flex><span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>initial</span><span style=color:#f92672>-</span><span style=color:#a6e22e>advertise</span><span style=color:#f92672>-</span><span style=color:#a6e22e>peer</span><span style=color:#f92672>-</span><span style=color:#a6e22e>urls</span> <span style=color:#a6e22e>http</span>:<span style=color:#75715e>//10.240.0.18:2380 --listen-peer-urls http://10.240.0.18:2380 \
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>advertise</span><span style=color:#f92672>-</span><span style=color:#a6e22e>client</span><span style=color:#f92672>-</span><span style=color:#a6e22e>urls</span> <span style=color:#a6e22e>http</span>:<span style=color:#75715e>//10.240.0.18:2379 --listen-client-urls http://10.240.0.18:2379 \
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>discovery</span> <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#a6e22e>DISCOVERY</span>} \
</span></span><span style=display:flex><span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>initial</span><span style=color:#f92672>-</span><span style=color:#a6e22e>cluster</span><span style=color:#f92672>-</span><span style=color:#a6e22e>state</span> <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#a6e22e>CLUSTER_STATE</span>} <span style=color:#f92672>--</span><span style=color:#a6e22e>initial</span><span style=color:#f92672>-</span><span style=color:#a6e22e>cluster</span><span style=color:#f92672>-</span><span style=color:#a6e22e>token</span> <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#a6e22e>TOKEN</span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>etcd</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>data</span><span style=color:#f92672>-</span><span style=color:#a6e22e>dir</span>=<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>etcd</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>name</span> <span style=color:#a6e22e>n3</span> \
</span></span><span style=display:flex><span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>initial</span><span style=color:#f92672>-</span><span style=color:#a6e22e>advertise</span><span style=color:#f92672>-</span><span style=color:#a6e22e>peer</span><span style=color:#f92672>-</span><span style=color:#a6e22e>urls</span> <span style=color:#a6e22e>http</span>:<span style=color:#75715e>//10.240.0.19:2380 --listen-peer-urls http://10.240.0.19:2380 \
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>advertise</span><span style=color:#f92672>-</span><span style=color:#a6e22e>client</span><span style=color:#f92672>-</span><span style=color:#a6e22e>urls</span> <span style=color:#a6e22e>http</span>:<span style=color:#75715e>//10.240.0.19:2379 --listen-client-urls http:/10.240.0.19:2379 \
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>discovery</span> <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#a6e22e>DISCOVERY</span>} \
</span></span><span style=display:flex><span>	<span style=color:#f92672>--</span><span style=color:#a6e22e>initial</span><span style=color:#f92672>-</span><span style=color:#a6e22e>cluster</span><span style=color:#f92672>-</span><span style=color:#a6e22e>state</span> <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#a6e22e>CLUSTER_STATE</span>} <span style=color:#f92672>--</span><span style=color:#a6e22e>initial</span><span style=color:#f92672>-</span><span style=color:#a6e22e>cluster</span><span style=color:#f92672>-</span><span style=color:#a6e22e>token</span> <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#a6e22e>TOKEN</span>}
</span></span></code></pre></div><p>到此etcd集群就搭建起来了，可以使用etcdctl来连接etcd。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>export ETCDCTL_API<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>HOST_1<span style=color:#f92672>=</span>10.240.0.17
</span></span><span style=display:flex><span>HOST_2<span style=color:#f92672>=</span>10.240.0.18
</span></span><span style=display:flex><span>HOST_3<span style=color:#f92672>=</span>10.240.0.19
</span></span><span style=display:flex><span>ENDPOINTS<span style=color:#f92672>=</span>$HOST_1:2379,$HOST_2:2379,$HOST_3:2379
</span></span><span style=display:flex><span>etcdctl --endpoints<span style=color:#f92672>=</span>$ENDPOINTS member list
</span></span></code></pre></div><h2 id=go语言操作etcd>Go语言操作etcd
<a class=header-anchor href=#go%e8%af%ad%e8%a8%80%e6%93%8d%e4%bd%9cetcd></a></h2><p>这里使用官方的
<a href=https://github.com/etcd-io/etcd/tree/master/clientv3 title=etcd/clientv3 rel="noopener external nofollow noreferrer" target=_blank class=exturl>etcd/clientv3
<i class="fa fa-external-link-alt"></i>
</a>包来连接etcd并进行相关操作。</p><h3 id=安装>安装
<a class=header-anchor href=#%e5%ae%89%e8%a3%85></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#a6e22e>get</span> <span style=color:#66d9ef>go</span>.<span style=color:#a6e22e>etcd</span>.<span style=color:#a6e22e>io</span><span style=color:#f92672>/</span><span style=color:#a6e22e>etcd</span><span style=color:#f92672>/</span><span style=color:#a6e22e>clientv3</span>
</span></span></code></pre></div><h3 id=put和get操作>put和get操作
<a class=header-anchor href=#put%e5%92%8cget%e6%93%8d%e4%bd%9c></a></h3><p>put命令用来设置键值对数据，get命令用来根据key获取值。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;go.etcd.io/etcd/clientv3&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// etcd client put/get demo
</span></span></span><span style=display:flex><span><span style=color:#75715e>// use etcd/clientv3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cli</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>Config</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Endpoints</span>:   []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;127.0.0.1:2379&#34;</span>},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>DialTimeout</span>: <span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>,
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// handle error!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;connect to etcd failed, err:%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;connect to etcd success&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>	<span style=color:#75715e>// put
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;q1mi&#34;</span>, <span style=color:#e6db74>&#34;dsb&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;put to etcd failed, err:%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// get
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> = <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;q1mi&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;get from etcd failed, err:%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>ev</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Kvs</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%s:%s\n&#34;</span>, <span style=color:#a6e22e>ev</span>.<span style=color:#a6e22e>Key</span>, <span style=color:#a6e22e>ev</span>.<span style=color:#a6e22e>Value</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=watch操作>watch操作
<a class=header-anchor href=#watch%e6%93%8d%e4%bd%9c></a></h3><p>watch用来获取未来更改的通知。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;go.etcd.io/etcd/clientv3&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// watch demo
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cli</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>Config</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Endpoints</span>:   []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;127.0.0.1:2379&#34;</span>},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>DialTimeout</span>: <span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>,
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;connect to etcd failed, err:%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;connect to etcd success&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>	<span style=color:#75715e>// watch key:q1mi change
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>rch</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#e6db74>&#34;q1mi&#34;</span>) <span style=color:#75715e>// &lt;-chan WatchResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>wresp</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>rch</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>ev</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>wresp</span>.<span style=color:#a6e22e>Events</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Type: %s Key:%s Value:%s\n&#34;</span>, <span style=color:#a6e22e>ev</span>.<span style=color:#a6e22e>Type</span>, <span style=color:#a6e22e>ev</span>.<span style=color:#a6e22e>Kv</span>.<span style=color:#a6e22e>Key</span>, <span style=color:#a6e22e>ev</span>.<span style=color:#a6e22e>Kv</span>.<span style=color:#a6e22e>Value</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>将上面的代码保存编译执行，此时程序就会等待etcd中q1mi这个key的变化。</p><p>例如：我们打开终端执行以下命令修改、删除、设置q1mi这个key。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>etcd</span>&gt; <span style=color:#a6e22e>etcdctl</span>.<span style=color:#a6e22e>exe</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>endpoints</span>=<span style=color:#a6e22e>http</span>:<span style=color:#75715e>//127.0.0.1:2379 put q1mi &#34;dsb2&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>OK</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>etcd</span>&gt; <span style=color:#a6e22e>etcdctl</span>.<span style=color:#a6e22e>exe</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>endpoints</span>=<span style=color:#a6e22e>http</span>:<span style=color:#75715e>//127.0.0.1:2379 del q1mi
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>etcd</span>&gt; <span style=color:#a6e22e>etcdctl</span>.<span style=color:#a6e22e>exe</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>endpoints</span>=<span style=color:#a6e22e>http</span>:<span style=color:#75715e>//127.0.0.1:2379 put q1mi &#34;dsb3&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>OK</span>
</span></span></code></pre></div><p>上面的程序都能收到如下通知。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>watch</span>&gt;<span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>exe</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>connect</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>etcd</span> <span style=color:#a6e22e>success</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Type</span>: <span style=color:#a6e22e>PUT</span> <span style=color:#a6e22e>Key</span>:<span style=color:#a6e22e>q1mi</span> <span style=color:#a6e22e>Value</span>:<span style=color:#a6e22e>dsb2</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Type</span>: <span style=color:#a6e22e>DELETE</span> <span style=color:#a6e22e>Key</span>:<span style=color:#a6e22e>q1mi</span> <span style=color:#a6e22e>Value</span>:
</span></span><span style=display:flex><span><span style=color:#a6e22e>Type</span>: <span style=color:#a6e22e>PUT</span> <span style=color:#a6e22e>Key</span>:<span style=color:#a6e22e>q1mi</span> <span style=color:#a6e22e>Value</span>:<span style=color:#a6e22e>dsb3</span>
</span></span></code></pre></div><h3 id=lease租约>lease租约
<a class=header-anchor href=#lease%e7%a7%9f%e7%ba%a6></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// etcd lease
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;go.etcd.io/etcd/clientv3&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cli</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>Config</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Endpoints</span>:   []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;127.0.0.1:2379&#34;</span>},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>DialTimeout</span>: <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;connect to etcd success.&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 创建一个5秒的租约
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Grant</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>(), <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 5秒钟之后, /nazha/ 这个key就会被移除
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>(), <span style=color:#e6db74>&#34;/nazha/&#34;</span>, <span style=color:#e6db74>&#34;dsb&#34;</span>, <span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>WithLease</span>(<span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>ID</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=keepalive>keepAlive
<a class=header-anchor href=#keepalive></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;go.etcd.io/etcd/clientv3&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// etcd keepAlive
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cli</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>Config</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Endpoints</span>:   []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;127.0.0.1:2379&#34;</span>},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>DialTimeout</span>: <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;connect to etcd success.&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Grant</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>(), <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>(), <span style=color:#e6db74>&#34;/nazha/&#34;</span>, <span style=color:#e6db74>&#34;dsb&#34;</span>, <span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>WithLease</span>(<span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>ID</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// the key &#39;foo&#39; will be kept forever
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>ch</span>, <span style=color:#a6e22e>kaerr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>KeepAlive</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>(), <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>ID</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>kaerr</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>kaerr</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ka</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ttl:&#34;</span>, <span style=color:#a6e22e>ka</span>.<span style=color:#a6e22e>TTL</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=基于etcd实现分布式锁>基于etcd实现分布式锁
<a class=header-anchor href=#%e5%9f%ba%e4%ba%8eetcd%e5%ae%9e%e7%8e%b0%e5%88%86%e5%b8%83%e5%bc%8f%e9%94%81></a></h3><p>go.etcd.io/etcd/clientv3/concurrency在etcd之上实现并发操作，如分布式锁、屏障和选举。</p><p>导入该包：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;go.etcd.io/etcd/clientv3/concurrency&#34;</span>
</span></span></code></pre></div><p>基于etcd实现的分布式锁示例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>cli</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>clientv3</span>.<span style=color:#a6e22e>Config</span>{<span style=color:#a6e22e>Endpoints</span>: <span style=color:#a6e22e>endpoints</span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建两个单独的会话用来演示锁竞争
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>s1</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>concurrency</span>.<span style=color:#a6e22e>NewSession</span>(<span style=color:#a6e22e>cli</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>s1</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>m1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>concurrency</span>.<span style=color:#a6e22e>NewMutex</span>(<span style=color:#a6e22e>s1</span>, <span style=color:#e6db74>&#34;/my-lock/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>s2</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>concurrency</span>.<span style=color:#a6e22e>NewSession</span>(<span style=color:#a6e22e>cli</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>s2</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>m2</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>concurrency</span>.<span style=color:#a6e22e>NewMutex</span>(<span style=color:#a6e22e>s2</span>, <span style=color:#e6db74>&#34;/my-lock/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// 会话s1获取锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>m1</span>.<span style=color:#a6e22e>Lock</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>()); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;acquired lock for s1&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>m2Locked</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{})
</span></span><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> close(<span style=color:#a6e22e>m2Locked</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 等待直到会话s1释放了/my-lock/的锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>m2</span>.<span style=color:#a6e22e>Lock</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>()); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>m1</span>.<span style=color:#a6e22e>Unlock</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>()); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;released lock for s1&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>m2Locked</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;acquired lock for s2&#34;</span>)
</span></span></code></pre></div><p>输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>acquired lock for s1
</span></span><span style=display:flex><span>released lock for s1
</span></span><span style=display:flex><span>acquired lock for s2
</span></span></code></pre></div><p><a href=https://godoc.org/go.etcd.io/etcd/clientv3/concurrency title=查看文档了解更多 rel="noopener external nofollow noreferrer" target=_blank class=exturl>查看文档了解更多
<i class="fa fa-external-link-alt"></i></a></p><h2 id=文章转自>文章转自
<a class=header-anchor href=#%e6%96%87%e7%ab%a0%e8%bd%ac%e8%87%aa></a></h2><ul><li><a href=https://www.liwenzhou.com/posts/Go/go_etcd/ title=https://www.liwenzhou.com/posts/Go/go_etcd/ rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://www.liwenzhou.com/posts/Go/go_etcd/
<i class="fa fa-external-link-alt"></i></a></li></ul></div><footer class=post-footer><div class=post-tags><a href=/tags/boltdb>boltdb
</a><a href=/tags/etcd>etcd
</a><a href=/tags/golang>golang
</a><a href=/tags/%e6%95%b0%e6%8d%ae%e5%ba%93>数据库
</a><a href=/tags/kubernetes>kubernetes</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
golang操作etcd</li><li class=post-copyright-author><strong>本文作者： </strong>daemon365</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://daemon365.dev/post/go/golang_operates_etcd/ title=golang操作etcd>https://daemon365.dev/post/go/golang_operates_etcd/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/network/http_and_https/ rel=next title=http和https><i class="fa fa-chevron-left"></i> http和https</a></div><div class="post-nav-prev post-nav-item"><a href=/post/microservice/isolation/ rel=prev title=隔离>隔离
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=utterances-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2019 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>daemon365</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.139.4 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.6.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div></div></footer><script type=text/javascript src=https://daemon365.dev/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://daemon365.dev/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":false,"save":"manual"},"copybtn":true,"darkmode":false,"hostname":"https://daemon365.dev/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lawidget":{"id":"JmAHxEAUVgyS8B1c","js":"https://v6-widget.51.la/v6/laId/quote.js?theme=0\u0026col=true\u0026f=12\u0026display=0,0,0,1,0,1,1,1"},"lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":false,"enable":false,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"utterances":{"cfg":{"issueterm":"pathname","label":"comments","repo":"daemon365/blog","theme":"preferred-color-scheme"},"js":"https://utteranc.es/client.js"},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://daemon365.dev/3rd"}},"version":"4.6.3"}</script><script type=text/javascript src=/js/main.min.412b2d7d9cead6dbf9b4df1d9dcc9b5b7818e8e434f664050b4498e888bb3009.js defer></script></body></html>